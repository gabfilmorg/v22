• <u>Modificadores</u>: 1x softbox 80cm, rebatedores 5-em-1, conjunto de bandeiras portáteis<br><br>
                        
                        4. <strong>Áudio de Qualidade</strong><br>
                        • <u>Microfone shotgun</u>: Rode VideoMic NTG (versátil, usa bateria interna e pode conectar direto na câmera)<br>
                        • <u>Lapelas</u>: Sistema Rode Wireless GO (compacto, prático para entrevistas)<br>
                        • <u>Gravador</u>: Zoom H5 com módulo XLR/TRS (para backup e captação multicanal)<br>
                        • <u>Acessórios</u>: Deadcat para externas, cabo de backup, fone de monitoramento<br><br>
                        
                        5. <strong>Acessórios Cruciais</strong><br>
                        • Cartões SD UHS-II (mínimo 128GB) e discos externos para backup imediato<br>
                        • Baterias extras e carregadores (regra: 3x mais baterias do que você acha necessário)<br>
                        • Monitor externo Feelworld F6 Plus (para verificar foco e exposição)<br>
                        • Kit de limpeza de lentes e bolsa impermeável`
                    ],
                    
                    'budget': [
                        `<strong>Análise de orçamento e estratégias de otimização:</strong><br><br>
                        
                        1. <strong>Distribuição Recomendada para Curta-Metragem</strong><br>
                        Com base no orçamento informado de R$15.000, sugiro a seguinte distribuição:
                        
                        • <u>Equipe</u>: R$6.000 (40%)
                          - Diretor: R$1.500
                          - DP/Cinegrafista: R$1.200
                          - Técnico de Som: R$900
                          - Assistente de Produção: R$800
                          - Editor: R$1.600<br>
                        
                        • <u>Equipamentos</u>: R$3.750 (25%)
                          - Câmera e lentes: R$1.500
                          - Iluminação: R$900
                          - Som: R$750
                          - Acessórios: R$600<br>
                        
                        • <u>Produção</u>: R$3.000 (20%)
                          - Locações: R$1.200
                          - Arte/Figurino: R$900
                          - Alimentação: R$900<br>
                        
                        • <u>Pós-Produção</u>: R$1.500 (10%)
                          - Color grading: R$600
                          - Sound design: R$600
                          - Trilha: R$300<br>
                        
                        • <u>Contingência</u>: R$750 (5%)
                          - Reserva para imprevistos<br><br>
                        
                        2. <strong>Estratégias de Otimização</strong><br>
                        
                        • <u>Condensar Cronograma</u>: Reduza para 2-3 dias de filmagem, agrupando cenas por locação, não por ordem cronológica.<br>
                        
                        • <u>Equipe Multifuncional</u>: Busque profissionais que possam desempenhar múltiplas funções (ex: DP que também opera câmera).<br>
                        
                        • <u>Parcerias Estratégicas</u>:
                          - Busque locações gratuitas através de apoios culturais
                          - Negocie equipamentos por créditos/participação no projeto
                          - Considere alunos de escolas de cinema para funções assistentes<br>
                        
                        • <u>Renegociação de Cachês</u>: Ofereça percentual da distribuição/premiação futura em troca de redução no valor imediato.<br><br>
                        
                        3. <strong>Áreas para Economizar</strong><br>
                        
                        • <u>Equipamento</u>: Priorize câmeras mais simples com boas lentes em vez do contrário
                        • <u>Alimentação</u>: Prepare refeições com antecedência em vez de delivery
                        • <u>Deslocamento</u>: Concentre filmagens geograficamente
                        • <u>Arte</u>: Use o que está disponível e redesenhe cenas para acomodar recursos existentes`,
                        
                        `<strong>Estratégias para reduzir custos sem perder qualidade:</strong><br><br>
                        
                        1. <strong>Pré-Produção Expandida</strong><br>
                        • Invista mais tempo em pré-produção para reduzir dias de filmagem
                        • Crie storyboards detalhados para minimizar setups e tomadas desnecessárias
                        • Realize ensaios extensivos com elenco para otimizar tempo em set
                        • Pré-visualize cenas complexas com simulações ou animatics<br><br>
                        
                        2. <strong>Equipamentos & Tecnologia</strong><br>
                        • Utilize câmeras DSLR/mirrorless com perfis de cor flat em vez de cinema cameras
                        • Priorize iluminação LED (menor consumo, menos equipamentos de resfriamento)
                        • Considere tecnologias virtuais para substituir locações físicas quando viável
                        • Alugue equipamentos por pacotes semanais em vez de diárias<br><br>
                        
                        3. <strong>Abordagem Criativa</strong><br>
                        • Reescreva cenas complexas em locações únicas (menos deslocamentos)
                        • Reduza número de personagens secundários e figurantes
                        • Utilize filmagens em locais públicos com equipe reduzida (estilo guerrilha)
                        • Adote estética visual que complemente limitações (ex: iluminação natural, estilo documental)<br><br>
                        
                        4. <strong>Pós-Produção Inteligente</strong><br>
                        • Edite diariamente durante a produção para identificar lacunas imediatamente
                        • Utilize plugins e templates para efeitos visuais padrão
                        • Busque bibliotecas de sound design com licenças acessíveis
                        • Trabalhe com músicos emergentes buscando exposição<br><br>
                        
                        5. <strong>Negociações Estratégicas</strong><br>
                        • Ofereça pacotes para fornecedores (ex: mesmo serviço em múltiplos projetos)
                        • Negocie pagamentos escalonados para distribuidores de equipamentos
                        • Forme parcerias com escolas de cinema para acesso a equipamentos
                        • Busque patrocínios de produtos para necessidades específicas (alimentação, transporte)`
                    ],
                    
                    'schedule': [
                        `<strong>Otimização de cronograma para 3 dias de filmagem:</strong><br><br>
                        
                        <strong>Recomendações Gerais:</strong><br>
                        1. Agrupe cenas por locação, não por sequência no roteiro<br>
                        2. Priorize cenas mais complexas para o início do dia, quando a equipe está mais energizada<br>
                        3. Planeje no máximo 6-8 páginas de roteiro por dia (menos se houver cenas complexas)<br>
                        4. Reserve 1-2 horas de contingência diária para imprevistos<br><br>
                        
                        <strong>Dia 1 - Locação Principal (Interior):</strong><br>
                        • <u>07:00-08:00</u>: Chegada da equipe, setup inicial<br>
                        • <u>08:00-08:30</u>: Briefing e alinhamento do dia<br>
                        • <u>08:30-11:00</u>: Filmagem das cenas complexas (diálogos principais)<br>
                        • <u>11:00-12:00</u>: Cenas mais simples da mesma ambientação<br>
                        • <u>12:00-13:00</u>: Intervalo para almoço (escalonado para manter continuidade)<br>
                        • <u>13:00-16:00</u>: Sequências com múltiplos personagens<br>
                        • <u>16:00-18:00</u>: Inserts e planos de cobertura<br>
                        • <u>18:00-19:00</u>: Últimos ajustes e fechamento<br><br>
                        
                        <strong>Dia 2 - Locação Externa Principal:</strong><br>
                        • <u>06:00-07:00</u>: Chegada e setup antecipados para aproveitar luz matinal<br>
                        • <u>07:00-10:00</u>: Cenas que necessitam de luz da manhã<br>
                        • <u>10:00-12:00</u>: Cenas com menor dependência de condições específicas<br>
                        • <u>12:00-13:00</u>: Almoço (mantenha equipe mínima filmando inserts se necessário)<br>
                        • <u>13:00-16:00</u>: Cenas principais da locação externa<br>
                        • <u>16:00-18:00</u>: Aproveitar luz dourada para cenas emocionais<br>
                        • <u>18:00-19:00</u>: Possíveis cenas noturnas/crepúsculo (se aplicável)<br><br>
                        
                        <strong>Dia 3 - Locações Secundárias + Fechamento:</strong><br>
                        • <u>07:00-08:00</u>: Setup da primeira locação secundária<br>
                        • <u>08:00-11:00</u>: Filmagem na locação secundária 1<br>
                        • <u>11:00-12:00</u>: Deslocamento e setup para locação secundária 2<br>
                        • <u>12:00-13:00</u>: Almoço (durante deslocamento, se possível)<br>
                        • <u>13:00-16:00</u>: Filmagem na locação secundária 2<br>
                        • <u>16:00-18:00</u>: Cenas pendentes ou refilmagens necessárias<br>
                        • <u>18:00-19:00</u>: Encerramento e organização do material<br><br>
                        
                        <strong>Dicas de Execução:</strong><br>
                        1. Mantenha "documentos vivos" compartilhados com atualizações em tempo real<br>
                        2. Estabeleça protocolo claro para decisões rápidas quando surgirem problemas<br>
                        3. Designe alguém exclusivamente para monitorar o progresso vs. cronograma<br>
                        4. Realize reuniões de alinhamento de 10 minutos antes de cada novo setup`,
                        
                        `<strong>Modelo de cronograma de produção completo:</strong><br><br>
                        
                        <strong>PRÉ-PRODUÇÃO (6 semanas):</strong><br>
                        
                        <strong>Semanas 1-2: Desenvolvimento</strong><br>
                        • Finalização do roteiro e aprovação<br>
                        • Elaboração do orçamento detalhado<br>
                        • Montagem inicial da equipe-chave<br>
                        • Criação de documentos de visualização (moodboard, referências)<br><br>
                        
                        <strong>Semanas 3-4: Preparação</strong><br>
                        • Visitas técnicas e seleção final de locações<br>
                        • Casting de atores e contratações<br>
                        • Definição de equipamentos e testes técnicos<br>
                        • Desenvolvimento de arte, figurino e maquiagem<br>
                        • Elaboração do cronograma detalhado de filmagem<br><br>
                        
                        <strong>Semanas 5-6: Finalização da Pré</strong><br>
                        • Ensaios com elenco<br>
                        • Contratação de serviços (alimentação, transporte, seguros)<br>
                        • Autorizações e documentação legal<br>
                        • Tech scout com equipe completa<br>
                        • Reunião final de produção<br>
                        • Separação e checagem de equipamentos<br><br>
                        
                        <strong>PRODUÇÃO (2 semanas):</strong><br>
                        
                        <strong>Semana 1: Filmagens - Bloco A</strong><br>
                        • Dias 1-2: Locação principal interior<br>
                        • Dias 3-5: Locações externas principais<br><br>
                        
                        <strong>Semana 2: Filmagens - Bloco B</strong><br>
                        • Dias 6-8: Locações secundárias<br>
                        • Dia 9: Sequências especiais/efeitos<br>
                        • Dia 10: Coleta de inserts e contingência<br><br>
                        
                        <strong>PÓS-PRODUÇÃO (8 semanas):</strong><br>
                        
                        <strong>Semanas 1-2: Organização</strong><br>
                        • Log e sincronização de material<br>
                        • Montagem do primeiro corte (assembly)<br><br>
                        
                        <strong>Semanas 3-4: Edição</strong><br>
                        • Primeiro corte refinado<br>
                        • Feedback e ajustes<br>
                        • Segundo corte<br><br>
                        
                        <strong>Semanas 5-6: Finalização Visual</strong><br>
                        • Correção de cor<br>
                        • Efeitos visuais básicos<br>
                        • Motion graphics e títulos<br><br>
                        
                        <strong>Semanas 7-8: Finalização Sonora</strong><br>
                        • Edição de som e limpeza<br>
                        • Sound design<br>
                        • Mixagem final<br>
                        • Masterização<br><br>
                        
                        <strong>LANÇAMENTO (2 semanas):</strong><br>
                        • Preparação de materiais promocionais<br>
                        • Entregas técnicas<br>
                        • Inscrição em festivais<br>
                        • Exibição para equipe e colaboradores`
                    ]
                };
                
                // Selecionar exemplos aleatórios para a feature atual
                if (responseExamples[feature] && responseExamples[feature].length > 0) {
                    const selectedExample = responseExamples[feature][Math.floor(Math.random() * responseExamples[feature].length)];
                    response = selectedExample;
                } else {
                    // Resposta genérica se não houver exemplos específicos
                    response = `Estou analisando sua solicitação sobre ${featureNames[feature] || 'produção audiovisual'}. Como posso ajudar mais especificamente?`;
                }
                
                // Adicionar componente baseado no modo AI
                if (model === 'creative') {
                    // Modo criativo adiciona mais ideias e sugestões inovadoras
                    response += `<br><br><strong>Sugestão criativa adicional:</strong><br>Experimente abordar este desafio de forma não convencional, considerando técnicas híbridas ou conceitos de outras disciplinas artísticas para criar algo verdadeiramente único.`;
                } else if (model === 'precise') {
                    // Modo preciso adiciona mais detalhes técnicos e referências
                    response += `<br><br><strong>Considerações técnicas adicionais:</strong><br>Ao implementar estas sugestões, atente-se aos parâmetros específicos de seu equipamento e condições de produção para garantir resultados consistentes e de alta qualidade.`;
                }
                
                // Adicionar referências se configurado
                if (settings.includeReferences) {
                    response += `<br><br><strong>Referências relevantes:</strong><br>Estas recomendações são baseadas em práticas estabelecidas na indústria audiovisual e abordagens utilizadas em produções semelhantes.`;
                }
                
                return response;
            }
            
            // Gerar resposta com código
            function generateCodeResponse(message, feature) {
                // Em uma implementação real, isso seria substituído por uma chamada à API de IA
                
                // Exemplos de respostas com código para diferentes features
                const codeExamples = {
                    'creative': `<strong>Para criar o efeito visual que você mencionou, aqui está um exemplo de script em Adobe After Effects:</strong><br><br>

<div class="code-block">
    <div class="code-lang">JavaScript (After Effects)</div>
    <pre><code>// Efeito de transição dinâmica com parallax
var comp = app.project.activeItem;
if (comp && comp instanceof CompItem) {
    // Criar nova sólida para o efeito
    var solid = comp.layers.addSolid([0, 0, 0], "Transition Effect", comp.width, comp.height, 1.0);
    
    // Adicionar efeito de distorção
    var warpEffect = solid.Effects.addProperty("CC Ripple");
    warpEffect.property("Center").setValue([comp.width/2, comp.height/2]);
    warpEffect.property("Radius").setValue(100);
    
    // Animar o efeito
    var startTime = 2; // segundos
    var duration = 1.5; // segundos
    
    warpEffect.property("Radius").setValueAtTime(startTime, 0);
    warpEffect.property("Radius").setValueAtTime(startTime + duration/2, 200);
    warpEffect.property("Radius").setValueAtTime(startTime + duration, 0);
    
    // Adicionar desvanecimento
    solid.opacity.setValueAtTime(startTime, 0);
    solid.opacity.setValueAtTime(startTime + duration/4, 100);
    solid.opacity.setValueAtTime(startTime + duration*3/4, 100);
    solid.opacity.setValueAtTime(startTime + duration, 0);
}</code></pre>
    <div class="code-tools">
        <button class="code-tool copy-code">Copiar</button>
    </div>
</div>

<p>Este script cria uma transição com efeito de ondulação que pode ser personalizada ajustando os valores de raio e timing. O resultado é um efeito de distorção dinâmica que funciona bem para transições entre cenas com temas contrastantes.</p>

<p>Para modificar o estilo visual, você pode experimentar com diferentes efeitos como:</p>
<ul>
    <li>CC Lens para um efeito mais circular</li>
    <li>Turbulent Displace para um efeito mais orgânico</li>
    <li>Gaussian Blur combinado com máscaras para transições suaves</li>
</ul>`,

                    'equipment': `<strong>Para calcular as necessidades de iluminação do seu set, aqui está uma ferramenta útil em JavaScript:</strong><br><br>

<div class="code-block">
    <div class="code-lang">JavaScript</div>
    <pre><code>// Calculadora de iluminação para produção audiovisual
class LightingCalculator {
    constructor() {
        this.baseISO = 800;
        this.baseAperture = 2.8;
        this.targetEV = 10; // EV para ambiente moderadamente iluminado
    }
    
    // Calcular potência necessária em watts
    calculateRequiredPower(distance, modifier = 1.0) {
        // Fórmula: Potência = (distância² * EV * modificador) / (ISO/100)
        const iso = this.baseISO;
        const distanceSquared = Math.pow(distance, 2);
        const isoFactor = iso / 100;
        
        let requiredPower = (distanceSquared * this.targetEV * modifier) / isoFactor;
        
        // Ajuste para F-stop
        const fStopFactor = Math.pow(this.baseAperture, 2);
        requiredPower = requiredPower * (fStopFactor / 4); // Normalizado para f/2.0
        
        return Math.round(requiredPower);
    }
    
    // Calcular alcance efetivo de uma luz
    calculateEffectiveRange(power, modifier = 1.0) {
        const iso = this.baseISO;
        const isoFactor = iso / 100;
        const fStopFactor = Math.pow(this.baseAperture, 2);
        
        // Fórmula inversa
        const distance = Math.sqrt(
            (power * isoFactor) / (this.targetEV * modifier * (fStopFactor / 4))
        );
        
        return distance.toFixed(1);
    }
    
    // Sugerir setup baseado no tamanho do ambiente
    suggestLightingSetup(roomWidth, roomLength, roomHeight) {
        const roomArea = roomWidth * roomLength;
        const roomVolume = roomArea * roomHeight;
        
        let keyLight, fillLight, backLight;
        
        if (roomArea < 20) { // Ambiente pequeno
            keyLight = {type: "LED Panel", power: 60, modifier: 0.8};
            fillLight = {type: "LED Panel", power: 30, modifier: 0.8};
            backLight = {type: "LED Spot", power: 30, modifier: 1.2};
        } else if (roomArea < 50) { // Ambiente médio
            keyLight = {type: "LED Fresnel", power: 120, modifier: 1.0};
            fillLight = {type: "LED Panel", power: 60, modifier: 0.8};
            backLight = {type: "LED Spot", power: 60, modifier: 1.2};
        } else { // Ambiente grande
            keyLight = {type: "LED Fresnel", power: 300, modifier: 1.0};
            fillLight = {type: "LED Panel", power: 120, modifier: 0.8};
            backLight = {type: "LED Fresnel", power: 120, modifier: 1.2};
        }
        
        return {
            keyLight: {
                ...keyLight,
                distance: this.calculateEffectiveRange(keyLight.power, keyLight.modifier)
            },
            fillLight: {
                ...fillLight,
                distance: this.calculateEffectiveRange(fillLight.power, fillLight.modifier)
            },
            backLight: {
                ...backLight,
                distance: this.calculateEffectiveRange(backLight.power, backLight.modifier)
            }
        };
    }
}

// Exemplo de uso
const calculator = new LightingCalculator();

// Para um ambiente de 5m x 7m com 3m de altura
const setup = calculator.suggestLightingSetup(5, 7, 3);
console.log("Setup de Iluminação Recomendado:");
console.log(\`Luz Principal (Key): \${setup.keyLight.type}, \${setup.keyLight.power}W, Alcance: \${setup.keyLight.distance}m\`);
console.log(\`Luz de Preenchimento (Fill): \${setup.fillLight.type}, \${setup.fillLight.power}W, Alcance: \${setup.fillLight.distance}m\`);
console.log(\`Contraluz (Back): \${setup.backLight.type}, \${setup.backLight.power}W, Alcance: \${setup.backLight.distance}m\`);</code></pre>
    <div class="code-tools">
        <button class="code-tool copy-code">Copiar</button>
    </div>
</div>

<p>Esta calculadora ajuda a determinar a potência necessária das luzes com base no tamanho do ambiente e na distância até o sujeito. Você pode ajustar os parâmetros base como ISO e abertura para melhor refletir seu equipamento específico.</p>

<p>Para usar em seus próprios projetos:</p>
<ol>
    <li>Ajuste o valor <code>baseISO</code> para corresponder à sua câmera</li>
    <li>Modifique o <code>baseAperture</code> de acordo com suas lentes</li>
    <li>O <code>targetEV</code> pode ser ajustado dependendo do estilo visual (valores mais baixos para looks mais escuros)</li>
</ol>`,

                    'budget': `<strong>Aqui está uma ferramenta em JavaScript para ajudar no gerenciamento de orçamento do seu projeto:</strong><br><br>

<div class="code-block">
    <div class="code-lang">JavaScript</div>
    <pre><code>// Sistema de Gestão de Orçamento para Produção Audiovisual
class FilmBudget {
    constructor(projectName, totalBudget) {
        this.projectName = projectName;
        this.totalBudget = totalBudget;
        this.categories = {
            preProduction: { allocation: 0.10, spent: 0, items: [] },
            cast: { allocation: 0.15, spent: 0, items: [] },
            crew: { allocation: 0.20, spent: 0, items: [] },
            equipment: { allocation: 0.15, spent: 0, items: [] },
            locations: { allocation: 0.10, spent: 0, items: [] },
            production: { allocation: 0.10, spent: 0, items: [] },
            postProduction: { allocation: 0.15, spent: 0, items: [] },
            contingency: { allocation: 0.05, spent: 0, items: [] }
        };
    }
    
    // Adicionar despesa
    addExpense(category, description, amount) {
        if (!this.categories[category]) {
            throw new Error(\`Categoria "\${category}" não encontrada\`);
        }
        
        this.categories[category].items.push({
            description,
            amount,
            date: new Date().toISOString()
        });
        
        this.categories[category].spent += amount;
        
        return this;
    }
    
    // Remover despesa pelo índice
    removeExpense(category, index) {
        if (!this.categories[category]) {
            throw new Error(\`Categoria "\${category}" não encontrada\`);
        }
        
        if (index >= 0 && index < this.categories[category].items.length) {
            const amount = this.categories[category].items[index].amount;
            this.categories[category].spent -= amount;
            this.categories[category].items.splice(index, 1);
        }
        
        return this;
    }
    
    // Realocar orçamento entre categorias
    reallocateBudget(fromCategory, toCategory, percentage) {
        if (!this.categories[fromCategory] || !this.categories[toCategory]) {
            throw new Error("Categoria não encontrada");
        }
        
        const amount = this.totalBudget * (percentage / 100);
        this.categories[fromCategory].allocation -= amount / this.totalBudget;
        this.categories[toCategory].allocation += amount / this.totalBudget;
        
        return this;
    }
    
    // Verificar situação orçamentária
    getBudgetStatus() {
        let totalSpent = 0;
        const categoryStatus = {};
        
        for (const [category, data] of Object.entries(this.categories)) {
            const allocated = this.totalBudget * data.allocation;
            const remaining = allocated - data.spent;
            const percentSpent = (data.spent / allocated) * 100;
            
            categoryStatus[category] = {
                allocated,
                spent: data.spent,
                remaining,
                percentSpent,
                status: percentSpent > 90 ? "CRÍTICO" : 
                        percentSpent > 70 ? "ATENÇÃO" : "OK"
            };
            
            totalSpent += data.spent;
        }
        
        return {
            projectName: this.projectName,
            totalBudget: this.totalBudget,
            totalSpent,
            totalRemaining: this.totalBudget - totalSpent,
            percentSpent: (totalSpent / this.totalBudget) * 100,
            categories: categoryStatus
        };
    }
    
    // Gerar relatório
    generateReport() {
        const status = this.getBudgetStatus();
        let report = \`RELATÓRIO DE ORÇAMENTO: \${this.projectName}\\n\`;
        report += \`Orçamento Total: R$ \${status.totalBudget.toFixed(2)}\\n\`;
        report += \`Total Gasto: R$ \${status.totalSpent.toFixed(2)} (\${status.percentSpent.toFixed(1)}%)\\n\`;
        report += \`Saldo: R$ \${status.totalRemaining.toFixed(2)}\\n\\n\`;
        
        report += "DETALHAMENTO POR CATEGORIA:\\n";
        for (const [category, data] of Object.entries(status.categories)) {
            report += \`\\n\${category.toUpperCase()}:\\n\`;
            report += \`  Alocado: R$ \${data.allocated.toFixed(2)}\\n\`;
            report += \`  Gasto: R$ \${data.spent.toFixed(2)} (\${data.percentSpent.toFixed(1)}%)\\n\`;
            report += \`  Restante: R$ \${data.remaining.toFixed(2)}\\n\`;
            report += \`  Status: \${data.status}\\n\`;
            
            if (this.categories[category].items.length > 0) {
                report += "  Itens:\\n";
                this.categories[category].items.forEach((item, i) => {
                    report += \`    - \${item.description}: R$ \${item.amount.toFixed(2)}\\n\`;
                });
            }
        }
        
        return report;
    }
}

// Exemplo de uso
const curta = new FilmBudget("Curta-metragem: Cidade                    addContextCard('Erro', 'Seu navegador não suporta gravação de voz. Por favor, tente usar o teclado.');
                    return;
                }
                
                // Mostrar tooltip de voz
                voiceTooltip.classList.add('show');
                isVoiceRecording = true;
                
                // Simular gravação (em uma implementação real, aqui usaria a Web Speech API)
                setTimeout(() => {
                    if (isVoiceRecording) {
                        stopVoiceRecording("Como posso criar um roteiro para um curta-metragem?");
                    }
                }, 5000);
            }

            // Parar gravação de voz
            function stopVoiceRecording(transcription = null) {
                voiceTooltip.classList.remove('show');
                isVoiceRecording = false;
                
                // Se houver transcrição, usá-la como mensagem
                if (transcription) {
                    chatInputField.value = transcription;
                    // Disparar evento para atualizar altura do textarea
                    chatInputField.dispatchEvent(new Event('input'));
                }
            }

            // ===== SUGESTÕES CONTEXTUAIS =====
            // Atualizar sugestões baseadas na feature
            function updateSuggestedPrompts(feature) {
                const suggestions = {
                    'creative': [
                        "Preciso de ideias para um curta-metragem sobre natureza",
                        "Sugestões de abordagens visuais para documentário",
                        "Como posso tornar minha cena mais impactante?",
                        "Referências de filmes com estética cyberpunk"
                    ],
                    
                    'script': [
                        "Como melhorar o arco do meu protagonista?",
                        "Ideias para resolver um problema no terceiro ato",
                        "Como escrever diálogos mais naturais?",
                        "Estruturas narrativas para documentários"
                    ],
                    
                    'shot': [
                        "Lista de planos para cena de conversa entre dois personagens",
                        "Como planejar uma sequência de ação?",
                        "Sugestões de ângulos para cenas em espaços pequenos",
                        "Planos para cena emocional com pouco diálogo"
                    ],
                    
                    'location': [
                        "O que devo considerar ao escolher uma locação externa?",
                        "Como adaptar um apartamento para múltiplas cenas?",
                        "Checklist para avaliação técnica de locação",
                        "Alternativas para filmagem com orçamento limitado"
                    ],
                    
                    'equipment': [
                        "Qual kit de iluminação para entrevistas?",
                        "Câmeras recomendadas para filmagem noturna",
                        "Melhores lentes para espaços pequenos",
                        "Equipamentos essenciais para produção de baixo orçamento"
                    ],
                    
                    'budget': [
                        "Como distribuir orçamento de R$15.000 para um curta?",
                        "Áreas onde posso economizar sem perder qualidade",
                        "Estratégias para reduzir custos de produção",
                        "Modelos de orçamento para documentário"
                    ],
                    
                    'schedule': [
                        "Como organizar 5 diárias de filmagem eficientemente?",
                        "Modelo de cronograma para curta-metragem",
                        "Quanto tempo reservar para cada etapa da produção?",
                        "Como lidar com atrasos no cronograma?"
                    ]
                };
                
                // Se não houver sugestões disponíveis ou configuração desativada
                if (!suggestions[feature] || !settings.showSuggestions) {
                    suggestedPrompts.style.display = 'none';
                    return;
                }
                
                // Atualizar e mostrar chips
                const promptChipsContainer = suggestedPrompts.querySelector('.prompt-chips');
                promptChipsContainer.innerHTML = '';
                
                suggestions[feature].forEach(suggestion => {
                    const chip = document.createElement('div');
                    chip.className = 'prompt-chip';
                    chip.textContent = suggestion;
                    
                    chip.addEventListener('click', () => {
                        chatInputField.value = suggestion;
                        suggestedPrompts.style.display = 'none';
                        sendMessage();
                    });
                    
                    promptChipsContainer.appendChild(chip);
                });
                
                suggestedPrompts.style.display = 'block';
            }

            // Atualizar sugestões baseadas no projeto
            function updateProjectSuggestions(project) {
                const projectType = project.basicInfo.type || 'other';
                const projectStatus = project.basicInfo.status || 'planning';
                
                const suggestions = [];
                
                // Adicionar sugestões baseadas no tipo de projeto
                if (projectType === 'documentary') {
                    suggestions.push(
                        "Sugestões de abordagem para documentário",
                        "Estrutura narrativa para documentários",
                        "Técnicas de entrevista para documentários"
                    );
                } else if (projectType === 'shortfilm') {
                    suggestions.push(
                        "Ideias para desenvolver personagens no curta-metragem",
                        "Como otimizar o impacto visual com orçamento limitado",
                        "Referências de curtas com temática similar"
                    );
                } else if (projectType === 'commercial') {
                    suggestions.push(
                        "Técnicas de storytelling para comerciais eficazes",
                        "Como comunicar a mensagem da marca visualmente",
                        "Estruturas narrativas para comerciais de 30 segundos"
                    );
                }
                
                // Adicionar sugestões baseadas no status
                if (projectStatus === 'planning') {
                    suggestions.push(
                        "Checklist de pré-produção para este projeto",
                        "Como planejar um cronograma realista",
                        "Orçamento estimado para este tipo de produção"
                    );
                } else if (projectStatus === 'production') {
                    suggestions.push(
                        "Dicas para manter o cronograma durante filmagens",
                        "Como resolver problemas comuns durante filmagens",
                        "Checklist diário para diretor e produtor"
                    );
                } else if (projectStatus === 'postproduction') {
                    suggestions.push(
                        "Fluxo de trabalho eficiente para pós-produção",
                        "Como estruturar o processo de edição",
                        "Recursos para finalização de áudio e cor"
                    );
                }
                
                // Se não houver sugestões ou configuração desativada
                if (suggestions.length === 0 || !settings.showSuggestions) {
                    suggestedPrompts.style.display = 'none';
                    return;
                }
                
                // Atualizar e mostrar chips (máximo 4)
                const promptChipsContainer = suggestedPrompts.querySelector('.prompt-chips');
                promptChipsContainer.innerHTML = '';
                
                suggestions.slice(0, 4).forEach(suggestion => {
                    const chip = document.createElement('div');
                    chip.className = 'prompt-chip';
                    chip.textContent = suggestion;
                    
                    chip.addEventListener('click', () => {
                        chatInputField.value = suggestion;
                        suggestedPrompts.style.display = 'none';
                        sendMessage();
                    });
                    
                    promptChipsContainer.appendChild(chip);
                });
                
                suggestedPrompts.style.display = 'block';
            }

            // Adicionar sugestão única
            function addSuggestedPrompt(prompt) {
                if (!settings.showSuggestions) return;
                
                const promptChipsContainer = suggestedPrompts.querySelector('.prompt-chips');
                
                // Verificar se já existe
                const existingPrompts = Array.from(promptChipsContainer.querySelectorAll('.prompt-chip'))
                    .map(chip => chip.textContent);
                
                if (existingPrompts.includes(prompt)) return;
                
                const chip = document.createElement('div');
                chip.className = 'prompt-chip';
                chip.textContent = prompt;
                
                chip.addEventListener('click', () => {
                    chatInputField.value = prompt;
                    suggestedPrompts.style.display = 'none';
                    sendMessage();
                });
                
                // Adicionar como primeiro chip
                if (promptChipsContainer.firstChild) {
                    promptChipsContainer.insertBefore(chip, promptChipsContainer.firstChild);
                } else {
                    promptChipsContainer.appendChild(chip);
                }
                
                suggestedPrompts.style.display = 'block';
                
                // Limitar número de chips
                if (promptChipsContainer.childElementCount > 4) {
                    promptChipsContainer.removeChild(promptChipsContainer.lastChild);
                }
            }

            // Atualizar sugestões contextuais após troca de mensagens
            function updateContextualSuggestions(userMessage, aiResponse) {
                if (!settings.contextSuggestions) return;
                
                // Baseado na conversa e no contexto atual, sugerir próximos passos
                // Detectar menções a tópicos específicos
                const topicDetectors = {
                    'roteiro': "Como desenvolver mais o roteiro deste projeto?",
                    'iluminação': "Quais técnicas de iluminação funcionariam melhor?",
                    'orçamento': "Como otimizar o orçamento para esta produção?",
                    'equipamento': "Qual equipamento você recomenda para este tipo de cena?",
                    'cronograma': "Como organizar o cronograma de produção de forma eficiente?",
                    'locação': "O que devo considerar ao escolher locações para este projeto?",
                    'pós-produção': "Quais são as melhores práticas para pós-produção deste material?"
                };
                
                // Verificar se algum tópico foi mencionado
                for (const [topic, suggestion] of Object.entries(topicDetectors)) {
                    if (userMessage.toLowerCase().includes(topic) || aiResponse.toLowerCase().includes(topic)) {
                        addSuggestedPrompt(suggestion);
                        break; // Adicionar apenas uma sugestão contextual por vez
                    }
                }
            }

            // ===== GERADORES DE RESPOSTA =====
            // Estas funções simulam respostas de IA para fins de demo
            
            // Gerar resposta baseada na feature e modelo
            function generateResponse(message, feature, model) {
                // Em uma implementação real, isso seria substituído por uma chamada à API de IA
                let response = "";
                
                // Base de exemplos de respostas para cada feature
                const responseExamples = {
                    'creative': [
                        `<strong>Aqui estão algumas ideias criativas que podem ajudar seu projeto:</strong><br><br>
                        
                        1. <strong>Contraste Visual Temático</strong> - Utilize contrastes visuais para representar as dualidades de sua narrativa. Por exemplo, alterne entre cenas com cores quentes e frias, ou entre composições simétricas e assimétricas para destacar conflitos internos ou externos.<br><br>
                        
                        2. <strong>Narrativa Não-Linear</strong> - Experimente estruturas não-lineares que reflitam o estado emocional dos personagens. Flashbacks, flash-forwards e sequências oníricas podem adicionar profundidade e tornar sua história mais envolvente e menos previsível.<br><br>
                        
                        3. <strong>Sound Design Expressivo</strong> - O áudio pode transmitir emoções tão efetivamente quanto imagens. Considere utilizar design sonoro subjetivo para representar a percepção dos personagens, ou contrastes entre silêncio e sons intensos para criar impacto.<br><br>
                        
                        4. <strong>Metáforas Visuais</strong> - Incorpore objetos ou elementos recorrentes que funcionem como metáforas para os temas centrais. Estes símbolos podem evoluir visualmente ao longo da narrativa, refletindo a jornada dos personagens.<br><br>
                        
                        5. <strong>Técnica de Enquadramento Evolutivo</strong> - Comece com enquadramentos mais fechados e restritivos, e gradualmente evolua para planos mais abertos à medida que seu protagonista supera conflitos, representando visualmente seu crescimento e libertação.`,
                        
                        `<strong>Para sua abordagem visual, considere estas referências e técnicas:</strong><br><br>
                        
                        1. <strong>Paleta de Cores Significativa</strong> - Desenvolva uma paleta de cores com propósito narrativo. O filme "O Grande Hotel Budapeste" de Wes Anderson usa cores distintas para diferentes linhas temporais, ajudando na orientação do espectador.<br><br>
                        
                        2. <strong>Movimento de Câmera Expressivo</strong> - Faça do movimento de câmera um elemento narrativo. Movimentos lentos e fluidos para momentos contemplativos, movimentos instáveis para tensão, e composições estáticas para momentos de decisão.<br><br>
                        
                        3. <strong>Tableau Vivant</strong> - Para cenas de grande impacto emocional, experimente composições que remetam a pinturas clássicas, criando imagens memoráveis que ficam na mente do espectador.<br><br>
                        
                        4. <strong>Transições Criativas</strong> - Ao invés de cortes simples, utilize transições que contribuam para a narrativa: sobreposições significativas, match cuts temáticos, ou transições sonoras que conectem cenas.<br><br>
                        
                        5. <strong>Repetição com Variação</strong> - Revisitar locações ou enquadramentos similares em diferentes momentos da história, mas com variações sutis que refletem a mudança na situação ou nos personagens.`
                    ],
                    
                    'script': [
                        `<strong>Análise de estrutura e sugestões para seu roteiro:</strong><br><br>
                        
                        1. <strong>Arco do Protagonista</strong> - Certifique-se de que seu protagonista tenha uma clara transformação interna que acompanhe os eventos externos. Uma jornada emocional tangível ajuda o público a se conectar mesmo quando a trama é complexa.<br><br>
                        
                        2. <strong>Estabelecimento de Stakes</strong> - Nos primeiros 10-15 minutos, deixe claro o que está em jogo para o protagonista, tanto externa quanto internamente. O público precisa entender o que pode ser ganho ou perdido.<br><br>
                        
                        3. <strong>Ritmo dos Diálogos</strong> - Varie o ritmo e extensão dos diálogos. Cenas de exposição podem ser intercaladas com momentos de diálogo rápido ou silêncios significativos para evitar monotonia.<br><br>
                        
                        4. <strong>Subtexto nas Interações</strong> - Fortaleça o que não está sendo dito. Os personagens raramente dizem exatamente o que pensam na vida real. Crie camadas nas conversas onde as verdadeiras intenções estão abaixo da superfície.<br><br>
                        
                        5. <strong>Revisão do Terceiro Ato</strong> - Verifique se a resolução honra as promessas narrativas estabelecidas no início. Mesmo surpresas devem parecer inevitáveis em retrospecto, não arbitrárias.`,
                        
                        `<strong>Para aprimorar os diálogos em seu roteiro:</strong><br><br>
                        
                        1. <strong>Voz Única para Cada Personagem</strong> - Certifique-se de que cada personagem tenha um padrão de fala reconhecível. Isso inclui vocabulário preferido, estrutura de frases, e temas recorrentes que refletem sua personalidade e background.<br><br>
                        
                        2. <strong>Economia de Palavras</strong> - Corte diálogos até o essencial. Uma boa regra é: se uma linha pode ser removida sem afetar a compreensão da cena, provavelmente deve ser removida.<br><br>
                        
                        3. <strong>Conflito em Cada Troca</strong> - Mesmo em conversas aparentemente amigáveis, insira algum nível de conflito, desacordo ou tensão. Personagens que concordam completamente criam cenas estáticas.<br><br>
                        
                        4. <strong>Subversão de Expectativas</strong> - Evite que diálogos sigam exatamente o caminho esperado. Inserir uma resposta inesperada ou mudar abruptamente o tópico pode criar momentos memoráveis.<br><br>
                        
                        5. <strong>Diálogo como Ação</strong> - Trate o diálogo como uma forma de ação, onde personagens estão tentando conseguir algo uns dos outros, não apenas trocando informações.`
                    ],
                    
                    'shot': [
                        `<strong>Aqui está uma lista de planos sugerida para sua cena:</strong><br><br>
                        
                        1. <strong>Establishing Shot (Plano Geral)</strong> - Começa com plano aberto do ambiente para estabelecer localização e hora do dia. Revela o espaço e o contexto onde a ação ocorrerá.<br><br>
                        
                        2. <strong>Two-Shot (Plano Médio)</strong> - Enquadra os dois personagens em conversação, mostrando suas posições relativas e linguagem corporal inicial.<br><br>
                        
                        3. <strong>Over-the-Shoulder do Personagem A</strong> - Mostra o Personagem B do ponto de vista do Personagem A, capturando reações e estabelecendo a perspectiva de A.<br><br>
                        
                        4. <strong>Over-the-Shoulder do Personagem B</strong> - Inverte para mostrar o Personagem A do ponto de vista de B, balanceando a conversa.<br><br>
                        
                        5. <strong>Close-Up do Personagem A</strong> - Durante momento emocional chave, aproxime para capturar nuances de expressão e aumentar a intensidade.<br><br>
                        
                        6. <strong>Close-Up do Personagem B</strong> - Capture a reação emocional, especialmente se houver uma revelação importante.<br><br>
                        
                        7. <strong>Insert Shot (Detalhe)</strong> - Plano fechado em objeto significativo mencionado ou utilizado na cena, enfatizando sua importância.<br><br>
                        
                        8. <strong>Plano Médio Conjunto</strong> - Retorne para ambos no quadro, mas agora com proximidade/distância diferente refletindo a evolução da conversa.<br><br>
                        
                        9. <strong>Tracking Shot Final</strong> - Movimento suave seguindo um ou ambos personagens saindo da cena, sugerindo consequências contínuas da conversa.`,
                        
                        `<strong>Para sua sequência de ação, recomendo os seguintes planos:</strong><br><br>
                        
                        1. <strong>Plano Master Amplo</strong> - Estabeleça a geografia completa da cena, mostrando todos os elementos importantes e personagens antes de entrar nos planos mais específicos.<br><br>
                        
                        2. <strong>Planos de Impacto Rápidos</strong> - Utilize planos curtos (1-2 segundos) com diferentes ângulos para os momentos de maior ação, criando ritmo e intensidade.<br><br>
                        
                        3. <strong>Planos Subjetivos Estratégicos</strong> - Insira planos do ponto de vista do personagem em momentos estratégicos para aumentar a imersão do espectador na ação.<br><br>
                        
                        4. <strong>Planos de Reação</strong> - Intercale a ação com close-ups rápidos das reações dos personagens para manter o elemento emocional.<br><br>
                        
                        5. <strong>Plano Sequência para Momento Chave</strong> - Use um plano contínuo sem cortes para o momento mais importante da sequência, criando impacto por contraste com o ritmo acelerado dos outros cortes.<br><br>
                        
                        6. <strong>Planos de Obstáculos</strong> - Dedique planos específicos para mostrar os obstáculos enfrentados, ampliando a sensação de perigo e dificuldade.<br><br>
                        
                        7. <strong>Planos Macro para Detalhes Físicos</strong> - Close-ups extremos de detalhes como mãos, olhos ou objetos importantes para aumentar a tensão.<br><br>
                        
                        8. <strong>Plano de Resolução</strong> - Finalize com um plano mais sustentado mostrando o resultado da ação e a nova situação estabelecida.`
                    ],
                    
                    'location': [
                        `<strong>Análise da locação descrita para sua filmagem:</strong><br><br>
                        
                        1. <strong>Considerações de Iluminação</strong><br>
                        • A orientação leste-oeste significa luz forte e direcional pela manhã e entardecer
                        • Janelas grandes permitem boa luz natural, mas precisarão de difusores ou blackouts para controle
                        • Considere trazer refletores para preencher sombras duras, especialmente em dias ensolarados
                        • Planeje uma visita técnica no mesmo horário pretendido para filmagem para avaliar padrões exatos de luz<br><br>
                        
                        2. <strong>Desafios Acústicos</strong><br>
                        • Teto alto criará reverberação natural - excelente para atmosfera, mas desafiador para captação limpa de diálogos
                        • Recomendo usar microfones lapela para diálogos importantes
                        • Traga materiais para tratamento acústico temporário (mantas, espumas) para áreas críticas
                        • Realize testes de áudio antes da filmagem para identificar frequências problemáticas<br><br>
                        
                        3. <strong>Considerações Logísticas</strong><br>
                        • Verifique capacidade elétrica (amperes disponíveis) para equipamentos de iluminação
                        • A proximidade com avenida pode significar ruído de tráfego - programe gravações em horários de menor movimento
                        • Espaço adaptável permite múltiplos setups, mas planeje com antecedência o reposicionamento de móveis
                        • Garanta autorização por escrito para alterar temporariamente elementos do espaço<br><br>
                        
                        4. <strong>Potencial Visual</strong><br>
                        • Elementos arquitetônicos mencionados oferecem oportunidade para enquadramentos com profundidade
                        • Considere usar os diferentes níveis para criar hierarquia visual entre personagens
                        • A mistura de texturas modernas e clássicas pode complementar o tema de contraste do seu projeto`,
                        
                        `<strong>Checklist para avaliação técnica da locação:</strong><br><br>
                        
                        1. <strong>Avaliação de Luz</strong><br>
                        ☐ Direção da luz natural durante todo o período de filmagem<br>
                        ☐ Posição de janelas e aberturas<br>
                        ☐ Presença de superfícies refletivas problemáticas<br>
                        ☐ Possibilidade de controlar luz (cortinas, blackouts)<br>
                        ☐ Cor das paredes e como afetam a temperatura de cor<br><br>
                        
                        2. <strong>Avaliação de Som</strong><br>
                        ☐ Fontes de ruído externo (tráfego, construção, escolas)<br>
                        ☐ Acústica do espaço (reverberação, ecos)<br>
                        ☐ Sistemas que podem causar ruído (ar condicionado, geladeira)<br>
                        ☐ Isolamento entre ambientes<br>
                        ☐ Piso que pode produzir ruído durante movimentação<br><br>
                        
                        3. <strong>Logística</strong><br>
                        ☐ Capacidade elétrica e distribuição de tomadas<br>
                        ☐ Espaço para equipamentos e equipe<br>
                        ☐ Acesso para carga/descarga<br>
                        ☐ Estacionamento disponível<br>
                        ☐ Banheiros e áreas de apoio<br>
                        ☐ Wi-Fi e conectividade<br>
                        ☐ Segurança do local e equipamentos<br><br>
                        
                        4. <strong>Aspectos Legais</strong><br>
                        ☐ Autorizações necessárias<br>
                        ☐ Seguro<br>
                        ☐ Limitações de horário<br>
                        ☐ Restrições específicas do local<br>
                        ☐ Custos adicionais (limpeza, segurança)<br><br>
                        
                        5. <strong>Extras</strong><br>
                        ☐ Alternativas em caso de mau tempo (para locações externas)<br>
                        ☐ Hospedagem próxima (para filmagens em locais distantes)<br>
                        ☐ Alimentação e catering`
                    ],
                    
                    'equipment': [
                        `<strong>Recomendações de equipamentos para seu projeto:</strong><br><br>
                        
                        1. <strong>Câmera Principal</strong><br>
                        • <u>Sony FX6</u> - Ideal para seu projeto por combinar excelente latitude de exposição (15+ stops) com capacidade excepcional em baixa luz. O sensor full-frame permite profundidade de campo cinemática e captação em 4K até 120fps para slow motion.<br>
                        • Alternativa econômica: Blackmagic Pocket Cinema Camera 6K<br><br>
                        
                        2. <strong>Sistema de Lentes</strong><br>
                        • <u>Conjunto de Prime Lenses Sigma Cine</u> (24mm, 35mm, 50mm, 85mm) - Oferecem abertura T1.5 consistente, essencial para manter continuidade de exposição entre planos, além de marcações de foco precisas para seu assistente.<br>
                        • Recomendo adicionar uma <u>Zoom 24-70mm f/2.8</u> para situações documentais onde a troca rápida de focal é necessária.<br><br>
                        
                        3. <strong>Sistema de Estabilização</strong><br>
                        • <u>DJI Ronin RS 3 Pro</u> - Para os movimentos fluidos descritos no seu roteiro, com capacidade para o conjunto câmera+lente recomendado e controle preciso via app.<br>
                        • Complemente com <u>tripé fluido Manfrotto 504X</u> para planos estáticos e panorâmicas suaves.<br><br>
                        
                        4. <strong>Kit de Iluminação</strong><br>
                        • <u>2x Aputure 600X</u> - Oferecem potência suficiente mesmo para espaços amplos, temperatura de cor ajustável e efeitos programáveis necessários para cenas noturnas.<br>
                        • <u>2x Aputure MC RGBWW</u> - Luzes compactas para detalhes, contraluz e efeitos pontuais.<br>
                        • Conjunto de modificadores: 1x softbox 120cm, 1x parabólica 85cm, bandeiras e rebatedores.<br><br>
                        
                        5. <strong>Captação de Áudio</strong><br>
                        • <u>Microfone shotgun direcional Rode NTG5</u> - Excelente rejeição de som lateral e traseiro, ideal para ambientes urbanos.<br>
                        • <u>Kit de lapelas sem fio Rode Wireless GO II</u> (2 transmissores) - Para diálogos críticos em ambientes desafiadores.<br>
                        • <u>Gravador Zoom F6</u> - Gravação multicanal com pré-amplificadores ultra silenciosos e ampla faixa dinâmica.`,
                        
                        `<strong>Kit de produção para documentário com orçamento limitado:</strong><br><br>
                        
                        1. <strong>Câmera e Óptica</strong><br>
                        • <u>Câmera principal</u>: Sony A7III (boa em baixa luz, perfil S-Log3 para color grading, autofoco confiável)<br>
                        • <u>Lentes essenciais</u>: 
                          - Tamron 28-75mm f/2.8 (versátil para a maioria das situações)
                          - Sony 85mm f/1.8 (para entrevistas com belo bokeh)
                          - Samyang 14mm f/2.8 (para estabelecimento de locações)<br>
                        • <u>Filtros</u>: Kit básico ND variável e polarizador<br><br>
                        
                        2. <strong>Estabilização Acessível</strong><br>
                        • <u>Tripé</u>: Benro S6 (cabeça fluida com contrapeso para movimentos suaves)<br>
                        • <u>Estabilizador manual</u>: Zhiyun Crane M2 (para movimentos dinâmicos)<br>
                        • <u>Alternativa econômica</u>: Shoulder rig básico com contrapeso<br><br>
                        
                        3. <strong>Iluminação Eficiente</strong><br>
                        • <u>Kit chave</u>: 2x Godox SL-60W (LEDs potentes, DMX controlável, modificáveis)<br>
                        • <u>Preenchimento</u>: Painel Neewer 480 bi-color (ajustável 3200K-5600K)<br>
                        • <u>Modificadores<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>filmORG - AI Assist</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
    <style>
        :root {
            /* Cores Base - Esquema Futurista */
            --deep-space: #1A1B2E;
            --neon-blue: #00F5FF;
            --neon-purple: #B15EFF;
            --cyber-green: #00FFB2;
            --cyber-yellow: #FFD60A;
            --cyber-red: #FF5E5E;
            --soft-white: #F4F7FF;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.05);
            
            /* Gradientes */
            --gradient-primary: linear-gradient(135deg, var(--neon-blue), var(--neon-purple));
            --gradient-success: linear-gradient(135deg, var(--cyber-green), var(--neon-blue));
            --gradient-warning: linear-gradient(135deg, var(--cyber-yellow), var(--neon-purple));
            --gradient-danger: linear-gradient(135deg, var(--cyber-red), var(--neon-purple));

            /* Animações */
            --typing-speed: 15s;
            --blink-speed: 0.5s;
            
            /* Efeitos */
            --glass-blur: blur(10px);
            --neon-shadow: 0 0 15px rgba(0, 245, 255, 0.5);
            --card-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.2);
            
            /* Dimensões */
            --sidebar-width: 80px;
            --sidebar-width-expanded: 240px;
            --header-height: 70px;
            --border-radius: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Montserrat', sans-serif;
        }

        body {
            background-color: var(--deep-space);
            color: var(--soft-white);
            min-height: 100vh;
            display: flex;
            overflow-x: hidden;
            background-image: 
                radial-gradient(circle at 10% 20%, rgba(0, 245, 255, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(177, 94, 255, 0.1) 0%, transparent 20%);
            background-attachment: fixed;
        }

        /* Sidebar */
        .sidebar {
            width: var(--sidebar-width);
            background: rgba(26, 27, 46, 0.8);
            backdrop-filter: var(--glass-blur);
            border-right: 1px solid var(--glass-border);
            height: 100vh;
            position: fixed;
            display: flex;
            flex-direction: column;
            transition: width 0.3s ease;
            z-index: 1000;
        }

        .sidebar:hover {
            width: var(--sidebar-width-expanded);
        }

        .sidebar-logo {
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            height: var(--header-height);
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--gradient-primary);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 20px;
        }

        .logo-text {
            margin-left: 15px;
            font-size: 20px;
            color: var(--neon-blue);
        }

        .file-info {
            flex: 1;
        }

        .file-name {
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 3px;
            white-space: nowrap;
            text-overflow: ellipsis;
            overflow: hidden;
        }

        .file-meta {
            font-size: 12px;
            color: rgba(244, 247, 255, 0.6);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-remove {
            background: none;
            border: none;
            color: rgba(244, 247, 255, 0.6);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .file-remove:hover {
            color: var(--cyber-red);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.show {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background: var(--deep-space);
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--glass-border);
            box-shadow: var(--card-shadow);
            animation: scale-up 0.3s ease;
        }

        @keyframes scale-up {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--glass-border);
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--soft-white);
            font-size: 24px;
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-section {
            margin-bottom: 20px;
        }

        .modal-section-title {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            color: var(--neon-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid var(--glass-border);
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        /* Onboarding Carousel */
        .onboarding-carousel {
            padding: 20px;
            position: relative;
        }

        .carousel-slide {
            text-align: center;
            display: none;
            animation: fade 0.5s ease;
        }

        .carousel-slide.active {
            display: block;
        }

        @keyframes fade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .carousel-icon {
            font-size: 48px;
            margin-bottom: 20px;
            color: var(--neon-blue);
        }

        .carousel-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .carousel-text {
            font-size: 14px;
            line-height: 1.6;
            color: rgba(244, 247, 255, 0.8);
            margin-bottom: 20px;
        }

        .carousel-bullets {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .carousel-bullet {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            cursor: pointer;
            transition: all 0.3s;
        }

        .carousel-bullet.active {
            background: var(--neon-blue);
        }

        .carousel-navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
        }

        /* Settings Panel Styles */
        .settings-section {
            margin-bottom: 20px;
        }

        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid var(--glass-border);
        }

        .setting-label {
            font-size: 14px;
        }

        .setting-value {
            font-size: 14px;
            color: var(--neon-blue);
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }

        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: .4s;
            border-radius: 34px;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 18px;
            width: 18px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .toggle-slider {
            background-color: var(--neon-blue);
        }

        input:checked + .toggle-slider:before {
            transform: translateX(24px);
        }
        
        /* Loading animation for large operations */
        .loading-screen {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(26, 27, 46, 0.9);
            backdrop-filter: var(--glass-blur);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .loading-screen.show {
            opacity: 1;
            visibility: visible;
        }

        .loading-content {
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(0, 245, 255, 0.2);
            border-top: 3px solid var(--neon-blue);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }

        .loading-text {
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        .loading-subtext {
            font-size: 14px;
            color: rgba(244, 247, 255, 0.7);
        }

        /* Advanced code snippets */
        .code-block {
            position: relative;
            margin: 15px 0;
        }

        .code-lang {
            position: absolute;
            top: 0;
            right: 10px;
            font-size: 12px;
            color: rgba(244, 247, 255, 0.5);
            background: rgba(0, 0, 0, 0.3);
            padding: 2px 8px;
            border-radius: 0 0 5px 5px;
        }

        .code-tools {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
        }

        .code-tool {
            background: rgba(0, 0, 0, 0.4);
            border: none;
            color: rgba(244, 247, 255, 0.7);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .code-tool:hover {
            background: rgba(0, 245, 255, 0.2);
            color: var(--soft-white);
        }

        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.2);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(0, 245, 255, 0.3);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(0, 245, 255, 0.5);
        }

        /* Responsividade */
        @media (max-width: 1024px) {
            .ai-container {
                grid-template-columns: 1fr;
            }

            .ai-features {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                bottom: 0;
                width: 280px;
                z-index: 1001;
            }

            .ai-features.show {
                display: flex;
            }

            .mobile-sidebar-toggle {
                display: block;
                position: fixed;
                bottom: 20px;
                left: 20px;
                width: 50px;
                height: 50px;
                border-radius: 50%;
                background: var(--gradient-primary);
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: var(--card-shadow);
                z-index: 1000;
                cursor: pointer;
            }
        }

        @media (max-width: 768px) {
            .sidebar {
                width: 0;
            }

            .sidebar.show {
                width: var(--sidebar-width-expanded);
            }

            .main-content {
                margin-left: 0;
            }
            
            .input-toolbar {
                overflow-x: auto;
                padding-bottom: 8px;
            }
            
            .chat-header {
                flex-wrap: wrap;
            }
            
            .chat-tools {
                margin-left: 0;
                margin-top: 10px;
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-logo">
            <div class="logo-icon">F</div>
            <div class="logo-text">filmORG</div>
        </div>
        
        <nav class="sidebar-menu">
            <a href="dashboard.html" class="menu-item">
                <i class="menu-icon ri-dashboard-line"></i>
                <span class="menu-text">Dashboard</span>
            </a>
            <a href="projetos.html" class="menu-item">
                <i class="menu-icon ri-movie-line"></i>
                <span class="menu-text">Projetos</span>
            </a>
            <a href="equipe.html" class="menu-item">
                <i class="menu-icon ri-team-line"></i>
                <span class="menu-text">Equipe</span>
            </a>
            <a href="equipamentos.html" class="menu-item">
                <i class="menu-icon ri-camera-line"></i>
                <span class="menu-text">Equipamentos</span>
            </a>
            <a href="ai-assist.html" class="menu-item active">
                <i class="menu-icon ri-robot-line"></i>
                <span class="menu-text">AI Assist</span>
            </a>
            <a href="analytics.html" class="menu-item">
                <i class="menu-icon ri-bar-chart-line"></i>
                <span class="menu-text">Analytics</span>
            </a>
            <a href="agenda.html" class="menu-item">
                <i class="menu-icon ri-calendar-line"></i>
                <span class="menu-text">Agenda</span>
            </a>
            <a href="orcamento.html" class="menu-item">
                <i class="menu-icon ri-money-dollar-circle-line"></i>
                <span class="menu-text">Orçamento</span>
            </a>
            <a href="configuracoes.html" class="menu-item" style="margin-top: auto;">
                <i class="menu-icon ri-settings-line"></i>
                <span class="menu-text">Configurações</span>
            </a>
        </nav>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="header">
            <h1 class="page-title">AI Assist</h1>
            
            <div class="header-actions">
                <div class="notification-btn">
                    <i class="ri-notification-3-line"></i>
                    <div class="notification-badge">3</div>
                </div>
                <div class="user-profile">
                    <div class="user-avatar" id="user-initial">U</div>
                    <span class="user-name" id="user-name">Usuário</span>
                </div>
            </div>
        </div>
        
        <div class="ai-container">
            <!-- AI Assistant Sidebar -->
            <div class="ai-features">
                <h3 class="feature-title">
                    <i class="ri-robot-line"></i>
                    Assistente IA
                </h3>
                
                <!-- AI Model Selector -->
                <div class="ai-models">
                    <div class="model-selector">
                        <div class="setting-item">
                            <span class="setting-label">Entrada por Voz</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="voice-input-enabled" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h4 class="modal-section-title">
                        <i class="ri-database-2-line"></i>
                        Dados e Privacidade
                    </h4>
                    
                    <div class="settings-section">
                        <div class="setting-item">
                            <span class="setting-label">Histórico de Conversas</span>
                            <button class="btn btn-outline" id="clear-history">
                                Limpar Histórico
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" id="reset-settings">Restaurar Padrões</button>
                <button class="btn btn-primary" id="save-settings">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ===== ELEMENTOS DOM =====
            // Elementos principais
            const chatMessages = document.getElementById('chat-messages');
            const chatInputField = document.getElementById('chat-input-field');
            const sendBtn = document.getElementById('send-btn');
            const featureItems = document.querySelectorAll('.feature-item');
            const modelOptions = document.querySelectorAll('.model-option');
            const modelSlider = document.querySelector('.model-slider');
            const projectList = document.getElementById('project-list');
            const contextContainer = document.getElementById('context-container');
            const suggestedPrompts = document.getElementById('suggested-prompts');
            const promptChips = document.querySelectorAll('.prompt-chip');
            const voiceInputBtn = document.getElementById('voice-input');
            const voiceTooltip = document.getElementById('voice-tooltip');
            const voiceCancel = document.getElementById('voice-cancel');
            const fileInput = document.getElementById('file-input');
            const attachFileBtn = document.getElementById('attach-file');
            const fileUploadPreview = document.getElementById('file-upload-preview');
            const loadingScreen = document.getElementById('loading-screen');
            const formatBtns = document.querySelectorAll('.format-btn');
            const userInitialEl = document.getElementById('user-initial');
            const userNameEl = document.getElementById('user-name');

            // Elementos de modais e configurações
            const onboardingModal = document.getElementById('onboarding-modal');
            const showOnboardingBtn = document.getElementById('show-onboarding');
            const closeOnboardingBtn = document.getElementById('close-onboarding');
            const prevSlideBtn = document.getElementById('prev-slide');
            const nextSlideBtn = document.getElementById('next-slide');
            const carouselSlides = document.querySelectorAll('.carousel-slide');
            const carouselBullets = document.querySelectorAll('.carousel-bullet');
            
            const settingsModal = document.getElementById('settings-modal');
            const showSettingsBtn = document.getElementById('show-settings');
            const closeSettingsBtn = document.getElementById('close-settings');
            const saveSettingsBtn = document.getElementById('save-settings');
            const resetSettingsBtn = document.getElementById('reset-settings');
            const clearHistoryBtn = document.getElementById('clear-history');
            
            // Utilitários e outras funcionalidades
            const clearChatBtn = document.getElementById('clear-chat');
            const exportChatBtn = document.getElementById('export-chat');
            const toggleSidebarBtn = document.getElementById('toggle-sidebar');
            const mobileSidebarToggle = document.getElementById('mobile-toggle');
            const aiFeatures = document.querySelector('.ai-features');

            // ===== ESTADO DA APLICAÇÃO =====
            // Configurações do AI e interface
            let settings = {
                aiModel: 'balanced',
                thinkingMode: false,
                includeReferences: true,
                contextSuggestions: true,
                showSuggestions: true,
                showAnimations: true,
                voiceInputEnabled: true
            };

            // Estado do chat e contexto atual
            let currentFeature = 'creative';
            let projects = JSON.parse(localStorage.getItem('projects')) || [];
            let messages = JSON.parse(localStorage.getItem('ai_messages')) || [];
            let isTyping = false;
            let currentSlide = 1;
            let isVoiceRecording = false;
            let isFirstVisit = !localStorage.getItem('ai_assist_visited');
            let attachedFiles = [];

            // Mapeamento de nomes de funções
            const featureNames = {
                'creative': 'Ideias Criativas',
                'script': 'Assistente de Roteiro',
                'shot': 'Lista de Planos',
                'location': 'Análise de Locação',
                'equipment': 'Sugestões de Equipamentos',
                'budget': 'Análise de Orçamento',
                'schedule': 'Otimização de Agenda'
            };

            // ===== FUNÇÕES DE INICIALIZAÇÃO =====
            // Verificar usuário logado
            function initUserInfo() {
                const userEmail = localStorage.getItem('userEmail');
                if (userEmail) {
                    const initial = userEmail.charAt(0).toUpperCase();
                    userInitialEl.textContent = initial;
                    
                    // Pegar nome do usuário, se disponível
                    const users = JSON.parse(localStorage.getItem('users')) || [];
                    const user = users.find(u => u.email === userEmail);
                    if (user && user.name) {
                        const firstName = user.name.split(' ')[0];
                        userNameEl.textContent = firstName;
                    } else {
                        userNameEl.textContent = userEmail.split('@')[0];
                    }
                }
            }

            // Carregar projetos na sidebar
            function loadProjects() {
                projectList.innerHTML = '';
                
                if (projects.length === 0) {
                    const emptyItem = document.createElement('li');
                    emptyItem.className = 'feature-item';
                    emptyItem.innerHTML = '<span>Nenhum projeto</span>';
                    projectList.appendChild(emptyItem);
                    return;
                }
                
                // Mostrar apenas projetos ativos
                const activeProjects = projects.filter(p => {
                    return p.basicInfo && p.basicInfo.status && 
                        ['planning', 'preproduction', 'production', 'postproduction'].includes(p.basicInfo.status);
                });
                
                // Mostrar mensagem se não houver projetos ativos
                if (activeProjects.length === 0) {
                    const emptyItem = document.createElement('li');
                    emptyItem.className = 'feature-item';
                    emptyItem.innerHTML = '<span>Nenhum projeto ativo</span>';
                    projectList.appendChild(emptyItem);
                    return;
                }
                
                // Adicionar projetos ativos
                activeProjects.forEach(project => {
                    const projectItem = document.createElement('li');
                    projectItem.className = 'feature-item';
                    projectItem.dataset.project = project.id;
                    
                    const statusIcons = {
                        'planning': 'ri-draft-line',
                        'preproduction': 'ri-calendar-check-line',
                        'production': 'ri-movie-2-line',
                        'postproduction': 'ri-film-line'
                    };
                    
                    const icon = statusIcons[project.basicInfo.status] || 'ri-folder-line';
                    
                    projectItem.innerHTML = `
                        <i class="feature-icon ${icon}"></i>
                        <span>${project.basicInfo.title}</span>
                    `;
                    
                    projectItem.addEventListener('click', () => {
                        selectProject(project);
                    });
                    
                    projectList.appendChild(projectItem);
                });
            }

            // Verificar se deve mostrar onboarding
            function checkOnboarding() {
                if (isFirstVisit) {
                    setTimeout(() => {
                        showModal(onboardingModal);
                        localStorage.setItem('ai_assist_visited', true);
                    }, 500);
                }
            }

            // ===== NAVEGAÇÃO DE RECURSOS =====
            // Selecionar feature/modo do assistente
            function selectFeature(feature) {
                // Atualizar estado atual
                currentFeature = feature;
                
                // Atualizar classes ativas
                featureItems.forEach(item => {
                    if (item.dataset.feature === feature) {
                        item.classList.add('active');
                    } else {
                        item.classList.remove('active');
                    }
                });
                
                // Adicionar mensagem de boas-vindas do assistente
                if (messages.length === 0) {
                    const welcomeMessage = getFeatureWelcomeMessage(feature);
                    addMessage('ai', welcomeMessage);
                }
                
                // Atualizar sugestões contextuais
                updateSuggestedPrompts(feature);
            }

            // Selecionar projeto para contexto
            function selectProject(project) {
                // Construir uma mensagem informativa sobre o projeto
                const message = `
                    <div class="ai-thinking">
                        <div class="thinking-content">
                            <div class="thinking-title">
                                <i class="ri-folder-info-line"></i>
                                Contexto de Projeto Carregado
                            </div>
                            <div class="thinking-text">
                                Agora estou focado no projeto "${project.basicInfo.title}". 
                                O que você gostaria de saber sobre este ${getProjectTypeLabel(project.basicInfo.type || 'other')}?
                            </div>
                        </div>
                        <div class="thinking-glow"></div>
                    </div>
                `;
                
                // Adicionar card de contexto
                addContextCard('Projeto Ativo', `${project.basicInfo.title} (${getStatusLabel(project.basicInfo.status || 'planning')})`, project.id);
                
                // Adicionar mensagem ao chat
                addMessage('ai', message);
                
                // Atualizar sugestões baseadas no projeto
                updateProjectSuggestions(project);
            }

            // Obter mensagem de boas-vindas baseada na feature
            function getFeatureWelcomeMessage(feature) {
                const messages = {
                    'creative': "👋 Olá! Sou seu assistente de ideias criativas. Posso ajudar com conceitos visuais, abordagens narrativas, técnicas experimentais ou referências artísticas para sua produção. Como posso impulsionar seu projeto hoje?",
                    
                    'script': "👋 Olá! Sou seu assistente de roteiro. Posso ajudar a desenvolver personagens, estruturar narrativas, analisar cenas ou revisar diálogos. Como posso aprimorar sua história hoje?",
                    
                    'shot': "👋 Olá! Sou seu assistente de decupagem. Posso ajudar a planejar sequências visuais, criar listas de planos e sugerir ângulos de câmera para otimizar suas filmagens. Como posso ajudar hoje?",
                    
                    'location': "👋 Olá! Sou seu analista de locações. Posso ajudar a avaliar espaços para filmagem, considerar aspectos logísticos e técnicos, e sugerir adaptações para diferentes cenários. O que você está procurando?",
                    
                    'equipment': "👋 Olá! Sou seu consultor de equipamentos. Posso recomendar câmeras, lentes, iluminação e acessórios baseados nas necessidades específicas do seu projeto. Qual tipo de equipamento você precisa?",
                    
                    'budget': "👋 Olá! Sou seu analista de orçamento. Posso ajudar a otimizar recursos financeiros, analisar custos, sugerir alternativas econômicas e priorizar gastos para sua produção. Como posso ajudar hoje?",
                    
                    'schedule': "👋 Olá! Sou seu assistente de agenda. Posso ajudar a criar cronogramas eficientes, organizar diárias de filmagem, otimizar sequências de produção e evitar conflitos de agenda. Como posso ajudar hoje?"
                };
                
                return messages[feature] || "👋 Olá! Sou seu assistente de produção AI. Como posso ajudar com seu projeto audiovisual hoje?";
            }

            // Selecionar modelo de AI
            function selectModel(model) {
                // Atualizar estado
                settings.aiModel = model;
                
                // Atualizar UI
                modelOptions.forEach(option => {
                    if (option.dataset.model === model) {
                        option.classList.add('active');
                    } else {
                        option.classList.remove('active');
                    }
                });
                
                // Mover o slider
                modelSlider.className = `model-slider ${model}`;
                
                // Adicionar feedback ao usuário
                const modelFeedback = {
                    'balanced': "Modelo Equilibrado selecionado. Fornecerei respostas balanceadas com criatividade e precisão.",
                    'creative': "Modo Criativo ativado! Fornecerei respostas mais inventivas e inspiradoras.",
                    'precise': "Modo Preciso ativado. Fornecerei respostas mais técnicas e detalhadas."
                };
                
                // Adicionar card de contexto
                addContextCard('Modelo AI', modelFeedback[model]);
                
                // Salvar configuração
                saveSettings();
            }

            // ===== MANIPULAÇÃO DE MENSAGENS =====
            // Adicionar mensagem ao chat
            function addMessage(sender, content) {
                const messageEl = document.createElement('div');
                messageEl.className = `message ${sender}`;
                
                // Timestamp para a mensagem
                const timestamp = new Date().toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' });
                
                // Se for uma mensagem AI, adicionar tempo de resposta simulado
                const responseTime = sender === 'ai' ? Math.floor(Math.random() * 3) + 1 : 0;
                
                messageEl.innerHTML = `
                    <div class="message-bubble">${content}</div>
                    <div class="message-meta">
                        <span>${timestamp}</span>
                        ${sender === 'ai' ? `<span>Resposta em ${responseTime}s</span>` : ''}
                        ${sender === 'ai' ? 
                            `<div class="message-actions">
                                <button class="message-action copy-message" title="Copiar mensagem">
                                    <i class="ri-file-copy-line"></i>
                                </button>
                                <button class="message-action like-message" title="Curtir resposta">
                                    <i class="ri-thumb-up-line"></i>
                                </button>
                                <button class="message-action dislike-message" title="Não curtir resposta">
                                    <i class="ri-thumb-down-line"></i>
                                </button>
                            </div>`
                        : ''}
                    </div>
                `;
                
                // Adicionar ao DOM
                chatMessages.appendChild(messageEl);
                chatMessages.scrollTop = chatMessages.scrollHeight;
                
                // Adicionar event listeners para ações
                if (sender === 'ai') {
                    const copyBtn = messageEl.querySelector('.copy-message');
                    if (copyBtn) {
                        copyBtn.addEventListener('click', () => {
                            // Remover HTML e deixar apenas texto
                            const tempDiv = document.createElement('div');
                            tempDiv.innerHTML = content;
                            const textContent = tempDiv.textContent || tempDiv.innerText || "";
                            
                            navigator.clipboard.writeText(textContent).then(() => {
                                // Animação de feedback
                                copyBtn.innerHTML = '<i class="ri-check-line"></i>';
                                setTimeout(() => {
                                    copyBtn.innerHTML = '<i class="ri-file-copy-line"></i>';
                                }, 2000);
                            });
                        });
                    }
                    
                    const likeBtn = messageEl.querySelector('.like-message');
                    if (likeBtn) {
                        likeBtn.addEventListener('click', () => {
                            likeBtn.classList.toggle('active');
                            
                            // Se ativar o like, desativar o dislike
                            const dislikeBtn = messageEl.querySelector('.dislike-message');
                            if (dislikeBtn.classList.contains('active')) {
                                dislikeBtn.classList.remove('active');
                            }
                            
                            // Trocar ícone quando ativo
                            if (likeBtn.classList.contains('active')) {
                                likeBtn.innerHTML = '<i class="ri-thumb-up-fill"></i>';
                                likeBtn.style.color = 'var(--cyber-green)';
                            } else {
                                likeBtn.innerHTML = '<i class="ri-thumb-up-line"></i>';
                                likeBtn.style.color = '';
                            }
                        });
                    }
                    
                    const dislikeBtn = messageEl.querySelector('.dislike-message');
                    if (dislikeBtn) {
                        dislikeBtn.addEventListener('click', () => {
                            dislikeBtn.classList.toggle('active');
                            
                            // Se ativar o dislike, desativar o like
                            const likeBtn = messageEl.querySelector('.like-message');
                            if (likeBtn.classList.contains('active')) {
                                likeBtn.classList.remove('active');
                                likeBtn.innerHTML = '<i class="ri-thumb-up-line"></i>';
                                likeBtn.style.color = '';
                            }
                            
                            // Trocar ícone quando ativo
                            if (dislikeBtn.classList.contains('active')) {
                                dislikeBtn.innerHTML = '<i class="ri-thumb-down-fill"></i>';
                                dislikeBtn.style.color = 'var(--cyber-red)';
                                
                                // Mostrar feedback contextual
                                addContextCard('Feedback', 'Desculpe pela resposta insatisfatória. Por favor, descreva o que poderia ser melhorado para que eu possa ajustar minhas próximas respostas.');
                            } else {
                                dislikeBtn.innerHTML = '<i class="ri-thumb-down-line"></i>';
                                dislikeBtn.style.color = '';
                            }
                        });
                    }
                }
                
                // Salvar mensagem
                messages.push({
                    sender,
                    content,
                    timestamp: new Date().toISOString(),
                    feature: currentFeature,
                    model: settings.aiModel
                });
                
                localStorage.setItem('ai_messages', JSON.stringify(messages));
            }

            // Mostrar indicador de digitação
            function showTypingIndicator() {
                if (isTyping) return;
                
                isTyping = true;
                const indicator = document.createElement('div');
                indicator.className = 'typing-indicator';
                indicator.innerHTML = `
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                `;
                indicator.id = 'typing-indicator';
                
                chatMessages.appendChild(indicator);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Esconder indicador de digitação
            function hideTypingIndicator() {
                const indicator = document.getElementById('typing-indicator');
                if (indicator) {
                    indicator.remove();
                }
                isTyping = false;
            }

            // Obter resposta da IA
            function getAIResponse(message) {
                // Mostrar indicador de digitação
                showTypingIndicator();
                
                // Mostrar processo de "pensamento" se estiver ativado
                if (settings.thinkingMode) {
                    setTimeout(() => {
                        showAIThinking(message);
                    }, 500);
                }
                
                // Simular tempo de resposta (entre 1.5 e 4 segundos)
                const responseTime = Math.floor(Math.random() * 2500) + 1500;
                
                setTimeout(() => {
                    // Remover indicador de digitação
                    hideTypingIndicator();
                    
                    // Remover card de pensamento se existir
                    const thinkingCard = document.querySelector('.ai-thinking');
                    if (thinkingCard) {
                        thinkingCard.classList.add('fade-out');
                        setTimeout(() => {
                            thinkingCard.remove();
                        }, 300);
                    }
                    
                    // Gerar resposta baseada no modo e feature atuais
                    let response = '';
                    
                    // Se houver um prompt com código, formatar a resposta com blocos de código
                    if (message.includes('código') || message.includes('script') || 
                        message.includes('programação') || message.includes('html') || 
                        message.includes('css') || message.includes('javascript')) {
                        response = generateCodeResponse(message, currentFeature);
                    } else {
                        response = generateResponse(message, currentFeature, settings.aiModel);
                    }
                    
                    // Adicionar resposta ao chat
                    addMessage('ai', response);
                    
                    // Atualizar sugestões após enviar resposta
                    updateContextualSuggestions(message, response);
                }, responseTime);
            }

            // Mostrar processo de "pensamento" da IA
            function showAIThinking(message) {
                // Gerar um processo de pensamento baseado na mensagem
                const thinkingProcess = generateThinkingProcess(message, currentFeature);
                
                // Criar e adicionar elemento de pensamento
                const thinkingEl = document.createElement('div');
                thinkingEl.className = 'message ai';
                
                thinkingEl.innerHTML = `
                    <div class="message-bubble">
                        <div class="ai-thinking">
                            <div class="thinking-content">
                                <div class="thinking-title">
                                    <i class="ri-brain-line"></i>
                                    Processando sua solicitação...
                                </div>
                                <div class="thinking-text">
                                    ${thinkingProcess}
                                </div>
                            </div>
                            <div class="thinking-glow"></div>
                        </div>
                    </div>
                `;
                
                chatMessages.appendChild(thinkingEl);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }

            // Adicionar card de contexto
            function addContextCard(title, content, id = null) {
                // Verificar se já existe um card com mesmo ID
                if (id) {
                    const existingCard = document.querySelector(`.context-card[data-id="${id}"]`);
                    if (existingCard) {
                        existingCard.remove();
                    }
                }
                
                const cardId = id || `context-${Date.now()}`;
                
                const cardEl = document.createElement('div');
                cardEl.className = 'context-card';
                cardEl.dataset.id = cardId;
                
                cardEl.innerHTML = `
                    <div class="context-header">
                        <span>${title}</span>
                        <button class="context-close"><i class="ri-close-line"></i></button>
                    </div>
                    <div class="context-body">
                        ${content}
                    </div>
                `;
                
                // Adicionar event listener para fechar
                cardEl.querySelector('.context-close').addEventListener('click', () => {
                    cardEl.classList.add('fade-out');
                    setTimeout(() => {
                        cardEl.remove();
                    }, 300);
                });
                
                contextContainer.appendChild(cardEl);
                
                // Auto-remover após 30 segundos se não for um card de projeto
                if (!id || !id.startsWith('proj')) {
                    setTimeout(() => {
                        if (cardEl.parentNode) {
                            cardEl.classList.add('fade-out');
                            setTimeout(() => {
                                if (cardEl.parentNode) cardEl.remove();
                            }, 300);
                        }
                    }, 30000);
                }
            }

            // ===== MANIPULAÇÃO DE ENTRADA =====
            // Enviar mensagem
            function sendMessage() {
                const message = chatInputField.value.trim();
                
                if (!message) return;
                
                // Adicionar mensagem do usuário
                addMessage('user', message);
                
                // Limpar input
                chatInputField.value = '';
                
                // Ajustar altura do textarea
                chatInputField.style.height = 'auto';
                
                // Esconder sugestões depois de enviar mensagem
                suggestedPrompts.style.display = 'none';
                
                // Obter resposta da IA
                getAIResponse(message);
            }

            // Processar arquivo anexado
            function processAttachedFile(file) {
                // Verificar tamanho do arquivo (limite de 10MB)
                const maxSize = 10 * 1024 * 1024; // 10MB
                if (file.size > maxSize) {
                    addContextCard('Erro', 'O arquivo excede o limite de 10MB. Por favor, escolha um arquivo menor.');
                    return;
                }
                
                // Verificar tipos permitidos
                const allowedTypes = [
                    'image/jpeg', 'image/png', 'image/gif',
                    'application/pdf',
                    'text/plain',
                    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
                    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
                    'text/csv'
                ];
                
                if (!allowedTypes.includes(file.type)) {
                    addContextCard('Erro', 'Tipo de arquivo não suportado. Formatos permitidos: imagens, PDF, TXT, DOCX, XLSX, CSV.');
                    return;
                }
                
                // Mostrar loading
                loadingScreen.classList.add('show');
                
                // Simular processamento
                setTimeout(() => {
                    loadingScreen.classList.remove('show');
                    
                    // Adicionar à lista de arquivos
                    const fileId = `file-${Date.now()}`;
                    attachedFiles.push({
                        id: fileId,
                        name: file.name,
                        type: file.type,
                        size: file.size
                    });
                    
                    // Atualizar preview
                    updateFilePreview();
                    
                    // Adicionar card de contexto
                    addContextCard('Arquivo Processado', `Arquivo "${file.name}" foi carregado e está disponível para análise.`);
                    
                    // Adicionar sugestão contextual baseada no tipo de arquivo
                    if (file.type.includes('image')) {
                        addSuggestedPrompt(`Analise esta imagem e dê ideias visuais relacionadas`);
                    } else if (file.type.includes('pdf') || file.type.includes('word')) {
                        addSuggestedPrompt(`Analise este documento e dê feedback`);
                    } else if (file.type.includes('spreadsheet') || file.type.includes('csv')) {
                        addSuggestedPrompt(`Analise estes dados e gere insights para meu projeto`);
                    }
                }, 2000);
            }

            // Atualizar preview de arquivos
            function updateFilePreview() {
                fileUploadPreview.innerHTML = '';
                
                if (attachedFiles.length === 0) {
                    fileUploadPreview.style.display = 'none';
                    return;
                }
                
                fileUploadPreview.style.display = 'block';
                
                attachedFiles.forEach(file => {
                    const fileSize = formatFileSize(file.size);
                    
                    // Determinar ícone baseado no tipo
                    let fileIcon = 'ri-file-line';
                    if (file.type.includes('image')) fileIcon = 'ri-image-line';
                    else if (file.type.includes('pdf')) fileIcon = 'ri-file-pdf-line';
                    else if (file.type.includes('word')) fileIcon = 'ri-file-word-line';
                    else if (file.type.includes('spreadsheet') || file.type.includes('csv')) fileIcon = 'ri-file-excel-line';
                    
                    const fileEl = document.createElement('div');
                    fileEl.className = 'file-preview';
                    fileEl.dataset.id = file.id;
                    
                    fileEl.innerHTML = `
                        <div class="file-icon">
                            <i class="${fileIcon}"></i>
                        </div>
                        <div class="file-info">
                            <div class="file-name">${file.name}</div>
                            <div class="file-meta">
                                <span>${fileSize}</span>
                            </div>
                        </div>
                        <button class="file-remove" data-id="${file.id}">
                            <i class="ri-delete-bin-line"></i>
                        </button>
                    `;
                    
                    // Adicionar event listener para remover
                    fileEl.querySelector('.file-remove').addEventListener('click', (e) => {
                        const fileId = e.currentTarget.dataset.id;
                        attachedFiles = attachedFiles.filter(f => f.id !== fileId);
                        updateFilePreview();
                    });
                    
                    fileUploadPreview.appendChild(fileEl);
                });
            }

            // Formatar tamanho de arquivo
            function formatFileSize(bytes) {
                if (bytes < 1024) return bytes + ' bytes';
                else if (bytes < 1048576) return (bytes / 1024).toFixed(1) + ' KB';
                else return (bytes / 1048576).toFixed(1) + ' MB';
            }

            // Iniciar gravação de voz
            function startVoiceRecording() {
                if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
                    addContextCard('Erro', '="model-option balanced active" data-model="balanced">Equilibrado</div>
                        <div class="model-option creative" data-model="creative">Criativo</div>
                        <div class="model-option precise" data-model="precise">Preciso</div>
                        <div class="model-slider balanced"></div>
                    </div>
                </div>
                
                <ul class="feature-list">
                    <li class="feature-item active" data-feature="creative">
                        <i class="feature-icon ri-lightbulb-line"></i>
                        <span>Ideias Criativas</span>
                    </li>
                    <li class="feature-item" data-feature="script">
                        <i class="feature-icon ri-file-text-line"></i>
                        <span>Assistente de Roteiro</span>
                    </li>
                    <li class="feature-item" data-feature="shot">
                        <i class="feature-icon ri-movie-line"></i>
                        <span>Lista de Planos</span>
                    </li>
                    <li class="feature-item" data-feature="location">
                        <i class="feature-icon ri-map-pin-line"></i>
                        <span>Análise de Locação</span>
                    </li>
                    <li class="feature-item" data-feature="equipment">
                        <i class="feature-icon ri-camera-line"></i>
                        <span>Sugestões de Equipamentos</span>
                    </li>
                    <li class="feature-item" data-feature="budget">
                        <i class="feature-icon ri-money-dollar-circle-line"></i>
                        <span>Análise de Orçamento</span>
                    </li>
                    <li class="feature-item" data-feature="schedule">
                        <i class="feature-icon ri-calendar-line"></i>
                        <span>Otimização de Agenda</span>
                    </li>
                </ul>
                
                <h3 class="feature-title" style="margin-top: 30px;">
                    <i class="ri-folder-line"></i>
                    Projetos
                </h3>
                <ul class="feature-list" id="project-list">
                    <!-- Projetos serão carregados dinamicamente -->
                </ul>
                
                <h3 class="feature-title" style="margin-top: 20px;">
                    <i class="ri-information-line"></i>
                    Recursos
                </h3>
                
                <div class="feature-presentation">
                    <div class="feature-card" id="show-onboarding">
                        <div class="feature-card-title">
                            <i class="ri-guide-line"></i>
                            Tour de Recursos
                        </div>
                        <div class="feature-card-text">
                            Conheça as principais funcionalidades do AI Assist
                        </div>
                    </div>
                    <div class="feature-card" id="show-settings">
                        <div class="feature-card-title">
                            <i class="ri-settings-4-line"></i>
                            Configurações do AI
                        </div>
                        <div class="feature-card-text">
                            Personalize o comportamento do assistente
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Chat Interface -->
            <div class="chat-container">
                <div class="chat-header">
                    <div class="ai-avatar">
                        <div class="pulse-ring"></div>
                        <i class="ri-robot-line"></i>
                    </div>
                    <div class="ai-info">
                        <h3>
                            Assistente de Produção
                            <span class="verified-badge"><i class="ri-checkbox-circle-fill"></i></span>
                        </h3>
                        <p>
                            <i class="ri-record-circle-fill" style="color: var(--cyber-green); font-size: 10px;"></i>
                            Online e pronto para ajudar
                        </p>
                    </div>
                    
                    <div class="chat-tools">
                        <button class="chat-tool-btn has-tooltip" id="clear-chat">
                            <i class="ri-delete-bin-line"></i>
                            <span class="tooltip">Limpar conversa</span>
                        </button>
                        <button class="chat-tool-btn has-tooltip" id="export-chat">
                            <i class="ri-download-line"></i>
                            <span class="tooltip">Exportar conversa</span>
                        </button>
                        <button class="chat-tool-btn has-tooltip" id="toggle-sidebar">
                            <i class="ri-layout-left-line"></i>
                            <span class="tooltip">Alternar painel</span>
                        </button>
                    </div>
                </div>
                
                <div class="chat-messages" id="chat-messages">
                    <!-- Mensagens serão adicionadas dinamicamente -->
                </div>
                
                <div class="chat-input-area">
                    <div id="context-container">
                        <!-- Context cards serão adicionados dinamicamente quando necessário -->
                    </div>
                    
                    <div id="suggested-prompts" class="suggested-prompts">
                        <div class="prompt-chips">
                            <div class="prompt-chip">Preciso de ideias para um curta-metragem</div>
                            <div class="prompt-chip">Como otimizar iluminação para uma cena noturna?</div>
                            <div class="prompt-chip">Sugestão de cronograma para filmagem de 3 dias</div>
                            <div class="prompt-chip">Ajude com orçamento para documentário</div>
                        </div>
                    </div>
                    
                    <div id="file-upload-preview">
                        <!-- Aqui aparecerá a pré-visualização de arquivos quando forem anexados -->
                    </div>
                    
                    <div class="input-container">
                        <div class="input-toolbar">
                            <div class="formatting-actions">
                                <button class="format-btn" title="Negrito">
                                    <i class="ri-bold"></i>
                                </button>
                                <button class="format-btn" title="Itálico">
                                    <i class="ri-italic"></i>
                                </button>
                                <button class="format-btn" title="Link">
                                    <i class="ri-link"></i>
                                </button>
                                <button class="format-btn" title="Código">
                                    <i class="ri-code-line"></i>
                                </button>
                                <button class="format-btn" title="Lista">
                                    <i class="ri-list-check"></i>
                                </button>
                            </div>
                        </div>
                        
                        <textarea 
                            class="chat-input-field" 
                            id="chat-input-field" 
                            placeholder="Pergunte algo ou digite '/' para comandos..."
                            rows="1"></textarea>
                        
                        <div class="input-actions">
                            <div class="additional-actions">
                                <button class="action-btn has-tooltip" id="attach-file">
                                    <i class="ri-attachment-2"></i>
                                    <span class="tooltip">Anexar arquivo</span>
                                </button>
                                <button class="action-btn has-tooltip" id="voice-input">
                                    <i class="ri-mic-line"></i>
                                    <span class="tooltip">Ditado por voz</span>
                                </button>
                                <input type="file" id="file-input" style="display: none;">
                            </div>
                            
                            <button class="send-btn" id="send-btn">
                                <i class="ri-send-plane-fill"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Voice input tooltip -->
                <div class="voice-tooltip" id="voice-tooltip">
                    <div class="voice-wave">
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                        <div class="voice-bar"></div>
                    </div>
                    <div class="voice-text">Ouvindo... Fale algo</div>
                    <button class="voice-cancel" id="voice-cancel">Cancelar</button>
                </div>
                
                <!-- Loading screen -->
                <div class="loading-screen" id="loading-screen">
                    <div class="loading-content">
                        <div class="loading-spinner"></div>
                        <div class="loading-text">Processando arquivo...</div>
                        <div class="loading-subtext">Isso pode levar alguns instantes</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Mobile sidebar toggle button -->
        <div class="mobile-sidebar-toggle" id="mobile-toggle" style="display: none;">
            <i class="ri-robot-line"></i>
        </div>
    </div>
    
    <!-- Onboarding Modal -->
    <div class="modal-overlay" id="onboarding-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Bem-vindo ao AI Assist</h3>
                <button class="modal-close" id="close-onboarding">&times;</button>
            </div>
            <div class="modal-body">
                <div class="onboarding-carousel">
                    <div class="carousel-slide active" data-slide="1">
                        <div class="carousel-icon">
                            <i class="ri-robot-line"></i>
                        </div>
                        <h3 class="carousel-title">Assistente AI Avançado</h3>
                        <p class="carousel-text">
                            O AI Assist foi projetado especificamente para produções audiovisuais, 
                            oferecendo suporte em todas as etapas do seu projeto com conhecimento especializado.
                        </p>
                    </div>
                    
                    <div class="carousel-slide" data-slide="2">
                        <div class="carousel-icon">
                            <i class="ri-lightbulb-line"></i>
                        </div>
                        <h3 class="carousel-title">Ideias Criativas Personalizadas</h3>
                        <p class="carousel-text">
                            Obtenha sugestões de conceitos visuais, abordagens narrativas, 
                            técnicas inovadoras e referências artísticas para impulsionar sua criatividade.
                        </p>
                    </div>
                    
                    <div class="carousel-slide" data-slide="3">
                        <div class="carousel-icon">
                            <i class="ri-file-text-line"></i>
                        </div>
                        <h3 class="carousel-title">Assistente de Roteiro Intuitivo</h3>
                        <p class="carousel-text">
                            Receba feedback detalhado sobre seu roteiro, com análise de estrutura, 
                            personagens, diálogos e sugestões para aprimorar sua narrativa.
                        </p>
                    </div>
                    
                    <div class="carousel-slide" data-slide="4">
                        <div class="carousel-icon">
                            <i class="ri-camera-line"></i>
                        </div>
                        <h3 class="carousel-title">Sugestões Técnicas Especializadas</h3>
                        <p class="carousel-text">
                            Obtenha recomendações de equipamentos, configurações de câmera, 
                            técnicas de iluminação e direção otimizadas para o seu projeto específico.
                        </p>
                    </div>
                    
                    <div class="carousel-bullets">
                        <div class="carousel-bullet active" data-slide="1"></div>
                        <div class="carousel-bullet" data-slide="2"></div>
                        <div class="carousel-bullet" data-slide="3"></div>
                        <div class="carousel-bullet" data-slide="4"></div>
                    </div>
                    
                    <div class="carousel-navigation">
                        <button class="btn btn-outline" id="prev-slide" style="visibility: hidden;">Anterior</button>
                        <button class="btn btn-primary" id="next-slide">Próximo</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Configurações do AI Assist</h3>
                <button class="modal-close" id="close-settings">&times;</button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h4 class="modal-section-title">
                        <i class="ri-robot-line"></i>
                        Comportamento do Assistente
                    </h4>
                    
                    <div class="settings-section">
                        <div class="setting-item">
                            <span class="setting-label">Modo de Raciocínio</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="thinking-mode">
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <span class="setting-label">Incluir Referências</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="include-references" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <span class="setting-label">Sugestões Contextualizadas</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="context-suggestions" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="modal-section">
                    <h4 class="modal-section-title">
                        <i class="ri-chat-settings-line"></i>
                        Interface do Chat
                    </h4>
                    
                    <div class="settings-section">
                        <div class="setting-item">
                            <span class="setting-label">Chips de Sugestão</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-suggestions" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div class="setting-item">
                            <span class="setting-label">Animações</span>
                            <label class="toggle-switch">
                                <input type="checkbox" id="show-animations" checked>
                                <span class="toggle-slider"></span>
                            </label>
                        </div>
                        
                        <div classfont-weight: 600;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover .logo-text {
            opacity: 1;
        }

        .sidebar-menu {
            padding: 20px;
            flex: 1;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--soft-white);
            text-decoration: none;
        }

        .menu-item:hover {
            background: var(--glass-bg);
        }

        .menu-item.active {
            background: var(--gradient-primary);
            box-shadow: var(--neon-shadow);
        }

        .menu-icon {
            font-size: 20px;
            min-width: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-text {
            margin-left: 15px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .sidebar:hover .menu-text {
            opacity: 1;
        }

        /* Main Content */
        .main-content {
            margin-left: var(--sidebar-width);
            flex: 1;
            min-height: 100vh;
            padding: 20px;
            transition: margin-left 0.3s ease;
        }

        /* Header */
        .header {
            height: var(--header-height);
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 20px;
            background: rgba(26, 27, 46, 0.8);
            backdrop-filter: var(--glass-blur);
            border-radius: var(--border-radius);
            margin-bottom: 20px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .notification-btn {
            position: relative;
            cursor: pointer;
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--neon-purple);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* AI Assistant Container */
        .ai-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 20px;
            height: calc(100vh - var(--header-height) - 40px);
        }

        /* AI Features Sidebar */
        .ai-features {
            background: rgba(26, 27, 46, 0.8);
            backdrop-filter: var(--glass-blur);
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            padding: 20px;
            display: flex;
            flex-direction: column;
            overflow-y: auto;
            max-height: 100%;
        }

        .feature-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--neon-blue);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .feature-item {
            padding: 12px 15px;
            border-radius: var(--border-radius);
            margin-bottom: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .feature-item:hover {
            background: var(--glass-bg);
        }

        .feature-item.active {
            background: var(--glass-bg);
            border-left: 3px solid var(--neon-blue);
        }

        .feature-icon {
            font-size: 20px;
            color: var(--neon-blue);
        }

        /* AI Models Section */
        .ai-models {
            margin-top: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .model-selector {
            display: flex;
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            border-radius: var(--border-radius);
            padding: 3px;
            margin-top: 10px;
        }

        .model-option {
            flex: 1;
            padding: 8px 5px;
            text-align: center;
            border-radius: 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            z-index: 1;
        }

        .model-option.active {
            color: var(--deep-space);
            font-weight: 600;
        }

        .model-slider {
            position: absolute;
            width: calc(100% / 3);
            height: 85%;
            border-radius: 8px;
            top: 50%;
            transform: translateY(-50%);
            transition: all 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55);
            z-index: 0;
        }

        .model-slider.balanced {
            left: 3px;
            background: var(--neon-blue);
        }

        .model-slider.creative {
            left: calc(100% / 3);
            background: var(--neon-purple);
        }

        .model-slider.precise {
            left: calc(100% / 3 * 2);
            background: var(--cyber-green);
        }

        /* Chat Container */
        .chat-container {
            display: flex;
            flex-direction: column;
            background: rgba(26, 27, 46, 0.8);
            backdrop-filter: var(--glass-blur);
            border-radius: var(--border-radius);
            border: 1px solid var(--glass-border);
            overflow: hidden;
        }

        .chat-header {
            padding: 15px 20px;
            border-bottom: 1px solid var(--glass-border);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ai-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            position: relative;
        }

        .ai-avatar::after {
            content: '';
            position: absolute;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background-color: var(--cyber-green);
            border: 2px solid rgba(26, 27, 46, 0.8);
            bottom: -2px;
            right: -2px;
        }

        .ai-avatar .pulse-ring {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            background-color: rgba(0, 255, 178, 0.4);
            opacity: 0;
            transform: scale(1);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                opacity: 0.8;
                transform: scale(1);
            }
            100% {
                opacity: 0;
                transform: scale(1.5);
            }
        }

        .ai-info h3 {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 2px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .verified-badge {
            display: inline-flex;
            color: var(--cyber-green);
            font-size: 14px;
        }

        .ai-info p {
            font-size: 12px;
            color: rgba(244, 247, 255, 0.7);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .chat-tools {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-left: auto;
        }

        .chat-tool-btn {
            width: 34px;
            height: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--soft-white);
            cursor: pointer;
            transition: all 0.3s;
        }

        .chat-tool-btn:hover {
            background: rgba(0, 245, 255, 0.1);
            border-color: var(--neon-blue);
        }

        .chat-tool-btn.has-tooltip {
            position: relative;
        }

        .tooltip {
            position: absolute;
            bottom: -35px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .chat-tool-btn.has-tooltip:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .message {
            max-width: 85%;
            display: flex;
            flex-direction: column;
            gap: 8px;
            animation: fade-in 0.5s ease;
        }

        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .message.ai {
            align-self: flex-start;
        }

        .message.user {
            align-self: flex-end;
        }

        .message-bubble {
            padding: 15px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.5;
            position: relative;
        }

        .ai .message-bubble {
            background: rgba(0, 245, 255, 0.1);
            border-top-left-radius: 0;
        }

        .user .message-bubble {
            background: rgba(177, 94, 255, 0.1);
            border-top-right-radius: 0;
        }

        .message-meta {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 12px;
            color: rgba(244, 247, 255, 0.6);
        }

        .ai .message-meta {
            padding-left: 10px;
        }

        .user .message-meta {
            padding-right: 10px;
            justify-content: flex-end;
        }

        .message-actions {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .message-action {
            background: none;
            border: none;
            color: rgba(244, 247, 255, 0.6);
            cursor: pointer;
            font-size: 14px;
            padding: 3px;
            transition: all 0.3s;
        }

        .message-action:hover {
            color: var(--neon-blue);
        }

        .typing-indicator {
            display: flex;
            gap: 5px;
            padding: 10px;
            align-self: flex-start;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: var(--neon-blue);
            border-radius: 50%;
            opacity: 0.6;
            animation: typing-animation 1s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typing-animation {
            0%, 100% { opacity: 0.6; transform: translateY(0); }
            50% { opacity: 1; transform: translateY(-5px); }
        }

        /* Code block styling */
        pre {
            background: rgba(0, 0, 0, 0.2);
            padding: 12px;
            border-radius: 5px;
            overflow-x: auto;
            margin: 10px 0;
            border-left: 3px solid var(--neon-blue);
        }

        code {
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            color: var(--soft-white);
        }

        /* Enhanced Input Area */
        .chat-input-area {
            padding: 15px;
            border-top: 1px solid var(--glass-border);
        }

        .input-container {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            padding: 5px;
            display: flex;
            flex-direction: column;
            transition: all 0.3s;
        }

        .input-container:focus-within {
            border-color: var(--neon-blue);
            box-shadow: 0 0 0 2px rgba(0, 245, 255, 0.2);
        }

        .input-toolbar {
            display: flex;
            padding: 5px 10px;
        }

        .formatting-actions {
            display: flex;
            gap: 8px;
        }

        .format-btn {
            background: none;
            border: none;
            color: rgba(244, 247, 255, 0.6);
            cursor: pointer;
            font-size: 14px;
            padding: 3px;
            transition: all 0.3s;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
        }

        .format-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--soft-white);
        }

        .chat-input-field {
            flex: 1;
            background: none;
            border: none;
            color: var(--soft-white);
            padding: 8px 15px;
            outline: none;
            resize: none;
            min-height: 24px;
            max-height: 120px;
            overflow-y: auto;
            font-size: 14px;
        }

        .input-actions {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 5px 10px;
        }

        .additional-actions {
            display: flex;
            gap: 10px;
        }

        .action-btn {
            background: none;
            border: none;
            color: rgba(244, 247, 255, 0.6);
            cursor: pointer;
            font-size: 16px;
            padding: 3px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .action-btn:hover {
            color: var(--neon-blue);
        }

        .action-btn span {
            font-size: 12px;
        }

        .send-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--gradient-primary);
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            flex-shrink: 0;
        }

        .send-btn:hover {
            transform: scale(1.05);
            box-shadow: var(--neon-shadow);
        }

        .send-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Context Cards */
        .context-card {
            background: rgba(26, 27, 46, 0.8);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s;
            animation: slide-up 0.3s ease;
        }

        @keyframes slide-up {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .context-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 14px;
            font-weight: 600;
            color: var(--neon-blue);
        }

        .context-body {
            font-size: 13px;
            line-height: 1.5;
            color: rgba(244, 247, 255, 0.8);
        }

        .context-close {
            background: none;
            border: none;
            color: rgba(244, 247, 255, 0.6);
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }

        .context-close:hover {
            color: var(--neon-blue);
        }

        /* Suggested Prompts */
        .suggested-prompts {
            padding: 10px 0;
        }

        .prompt-chips {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 10px;
        }

        .prompt-chip {
            background: rgba(0, 245, 255, 0.1);
            border: 1px solid rgba(0, 245, 255, 0.2);
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            color: var(--soft-white);
        }

        .prompt-chip:hover {
            background: rgba(0, 245, 255, 0.2);
            border-color: var(--neon-blue);
        }

        /* Voice Input Tooltip */
        .voice-tooltip {
            position: absolute;
            bottom: 60px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: var(--glass-blur);
            border-radius: 20px;
            padding: 15px;
            width: 200px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .voice-tooltip.show {
            opacity: 1;
            visibility: visible;
        }

        .voice-wave {
            width: 100%;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 3px;
        }

        .voice-bar {
            width: 4px;
            height: 10px;
            background: var(--neon-blue);
            border-radius: 2px;
            animation: voice-wave 1s ease-in-out infinite;
        }

        @keyframes voice-wave {
            0%, 100% { height: 10px; }
            50% { height: 30px; }
        }

        .voice-bar:nth-child(1) { animation-delay: 0.0s; }
        .voice-bar:nth-child(2) { animation-delay: 0.1s; }
        .voice-bar:nth-child(3) { animation-delay: 0.2s; }
        .voice-bar:nth-child(4) { animation-delay: 0.3s; }
        .voice-bar:nth-child(5) { animation-delay: 0.4s; }
        .voice-bar:nth-child(6) { animation-delay: 0.5s; }
        .voice-bar:nth-child(7) { animation-delay: 0.6s; }
        .voice-bar:nth-child(8) { animation-delay: 0.5s; }
        .voice-bar:nth-child(9) { animation-delay: 0.4s; }
        .voice-bar:nth-child(10) { animation-delay: 0.3s; }
        .voice-bar:nth-child(11) { animation-delay: 0.2s; }
        .voice-bar:nth-child(12) { animation-delay: 0.1s; }

        .voice-text {
            font-size: 14px;
            text-align: center;
        }

        .voice-cancel {
            background: var(--gradient-danger);
            border: none;
            color: var(--soft-white);
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .voice-cancel:hover {
            transform: scale(1.05);
        }

        /* Feature Presentation */
        .feature-presentation {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-top: 15px;
        }

        .feature-card {
            background: rgba(26, 27, 46, 0.8);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            transition: all 0.3s;
        }

        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--neon-shadow);
            border-color: var(--neon-blue);
        }

        .feature-card-title {
            font-size: 14px;
            font-weight: 600;
            color: var(--neon-blue);
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .feature-card-text {
            font-size: 13px;
            line-height: 1.5;
            color: rgba(244, 247, 255, 0.8);
        }

        /* AI Thinking Animation */
        .ai-thinking {
            padding: 15px;
            background: rgba(0, 245, 255, 0.05);
            border-radius: var(--border-radius);
            margin-bottom: 15px;
            position: relative;
            overflow: hidden;
        }

        .thinking-content {
            position: relative;
            z-index: 1;
        }

        .thinking-title {
            font-size: 15px;
            font-weight: 600;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .thinking-title i {
            color: var(--neon-blue);
            animation: pulse-thinking 1.5s infinite;
        }

        @keyframes pulse-thinking {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 1; }
        }

        .thinking-text {
            font-size: 13px;
            line-height: 1.6;
            color: rgba(244, 247, 255, 0.8);
        }

        .thinking-glow {
            position: absolute;
            width: 50%;
            height: 100%;
            top: 0;
            background: linear-gradient(90deg, transparent, rgba(0, 245, 255, 0.1), transparent);
            animation: thinking-glow 2s infinite;
        }

        @keyframes thinking-glow {
            0% { left: -50%; }
            100% { left: 100%; }
        }

        /* File Upload Preview */
        .file-preview {
            background: rgba(26, 27, 46, 0.8);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 10px;
            margin-top: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .file-icon {
            width: 40px;
            height: 40px;
            border-radius: var(--border-radius);
            background: rgba(0, 245, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;

function getProjectTypeLabel(type) {
    const labels = {
        'shortfilm': 'curta-metragem',
        'documentary': 'documentário',
        'commercial': 'comercial',
        'musicvideo': 'videoclipe',
        'institutional': 'vídeo institucional',
        'webseries': 'websérie',
        'other': 'projeto'
    };
    return labels[type] || 'projeto';
}

// Formatar labels de status
function getStatusLabel(status) {
    const labels = {
        'planning': 'Planejamento',
        'preproduction': 'Pré-produção',
        'production': 'Produção',
        'postproduction': 'Pós-produção',
        'complete': 'Finalizado',
        'archived': 'Arquivado'
    };
    return labels[status] || 'Status desconhecido';
}

// === FUNÇÕES DE CONFIGURAÇÃO ===

// Salvar configurações
function saveSettings() {
    // Atualizar configurações baseado nos inputs
    settings.thinkingMode = document.getElementById('thinking-mode').checked;
    settings.includeReferences = document.getElementById('include-references').checked;
    settings.contextSuggestions = document.getElementById('context-suggestions').checked;
    settings.showSuggestions = document.getElementById('show-suggestions').checked;
    settings.showAnimations = document.getElementById('show-animations').checked;
    settings.voiceInputEnabled = document.getElementById('voice-input-enabled').checked;
    
    // Salvar no localStorage
    localStorage.setItem('ai_settings', JSON.stringify(settings));
    
    // Feedback visual
    addContextCard('Configurações', 'Suas preferências foram salvas com sucesso.');
}

// Carregar configurações
function loadSettings() {
    const savedSettings = localStorage.getItem('ai_settings');
    if (savedSettings) {
        settings = JSON.parse(savedSettings);
        
        // Atualizar elementos UI
        document.getElementById('thinking-mode').checked = settings.thinkingMode;
        document.getElementById('include-references').checked = settings.includeReferences;
        document.getElementById('context-suggestions').checked = settings.contextSuggestions;
        document.getElementById('show-suggestions').checked = settings.showSuggestions;
        document.getElementById('show-animations').checked = settings.showAnimations;
        document.getElementById('voice-input-enabled').checked = settings.voiceInputEnabled;
    }
}

// Resetar configurações
function resetSettings() {
    // Valores padrão
    settings = {
        aiModel: 'balanced',
        thinkingMode: false,
        includeReferences: true,
        contextSuggestions: true,
        showSuggestions: true,
        showAnimations: true,
        voiceInputEnabled: true
    };
    
    // Atualizar UI
    document.getElementById('thinking-mode').checked = settings.thinkingMode;
    document.getElementById('include-references').checked = settings.includeReferences;
    document.getElementById('context-suggestions').checked = settings.contextSuggestions;
    document.getElementById('show-suggestions').checked = settings.showSuggestions;
    document.getElementById('show-animations').checked = settings.showAnimations;
    document.getElementById('voice-input-enabled').checked = settings.voiceInputEnabled;
    
    // Salvar
    localStorage.setItem('ai_settings', JSON.stringify(settings));
    
    // Feedback
    addContextCard('Configurações', 'As configurações foram restauradas para os valores padrão.');
}

// === FUNÇÕES PARA MODAIS ===

// Mostrar modal
function showModal(modal) {
    modal.classList.add('show');
}

// Esconder modal
function hideModal(modal) {
    modal.classList.remove('show');
}

// Navegar entre slides do carrossel
function navigateSlide(direction) {
    // Esconder slide atual
    document.querySelector(`.carousel-slide[data-slide="${currentSlide}"]`).classList.remove('active');
    document.querySelector(`.carousel-bullet[data-slide="${currentSlide}"]`).classList.remove('active');
    
    // Atualizar índice
    if (direction === 'next') {
        currentSlide = currentSlide >= 4 ? 1 : currentSlide + 1;
    } else {
        currentSlide = currentSlide <= 1 ? 4 : currentSlide - 1;
    }
    
    // Mostrar novo slide
    document.querySelector(`.carousel-slide[data-slide="${currentSlide}"]`).classList.add('active');
    document.querySelector(`.carousel-bullet[data-slide="${currentSlide}"]`).classList.add('active');
    
    // Atualizar botões de navegação
    if (currentSlide === 1) {
        prevSlideBtn.style.visibility = 'hidden';
    } else {
        prevSlideBtn.style.visibility = 'visible';
    }
    
    if (currentSlide === 4) {
        nextSlideBtn.textContent = 'Concluir';
    } else {
        nextSlideBtn.textContent = 'Próximo';
    }
}

// === FUNÇÕES DE MANIPULAÇÃO DO CHAT ===

// Limpar chat
function clearChat() {
    // Confirmar com usuário
    if (confirm('Tem certeza que deseja limpar toda a conversa?')) {
        // Limpar DOM
        chatMessages.innerHTML = '';
        
        // Limpar estado
        messages = [];
        localStorage.removeItem('ai_messages');
        
        // Adicionar mensagem de boas-vindas
        const welcomeMessage = getFeatureWelcomeMessage(currentFeature);
        addMessage('ai', welcomeMessage);
    }
}

// Exportar chat
function exportChat() {
    // Verificar se há mensagens
    if (messages.length === 0) {
        addContextCard('Exportação', 'Não há mensagens para exportar');
        return;
    }
    
    // Formatar para texto
    let exportText = "=== Conversa filmORG AI Assist ===\n\n";
    messages.forEach(msg => {
        const sender = msg.sender === 'ai' ? 'AI Assistant' : 'Você';
        const date = new Date(msg.timestamp).toLocaleString('pt-BR');
        
        // Remover HTML e deixar apenas texto para melhor legibilidade
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = msg.content;
        const content = tempDiv.textContent || tempDiv.innerText || "";
        
        exportText += `[${date}] ${sender}:\n${content}\n\n`;
    });
    
    // Criar blob e link para download
    const blob = new Blob([exportText], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `filmorg-conversa-${new Date().toISOString().slice(0,10)}.txt`;
    
    // Simular clique e limpar URL
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
    
    // Feedback
    addContextCard('Exportação', 'Conversa exportada com sucesso');
}

// === FUNÇÕES DE EVENTOS E INICIALIZAÇÃO ===

// Inicializar eventos
function initEvents() {
    // Envio de mensagem
    sendBtn.addEventListener('click', sendMessage);
    chatInputField.addEventListener('keydown', e => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
    
    // Auto-resize do textarea
    chatInputField.addEventListener('input', () => {
        chatInputField.style.height = 'auto';
        chatInputField.style.height = chatInputField.scrollHeight + 'px';
    });
    
    // Acessibilidade de voz
    voiceInputBtn.addEventListener('click', () => {
        if (settings.voiceInputEnabled) {
            startVoiceRecording();
        } else {
            addContextCard('Entrada por Voz', 'A entrada por voz está desativada nas configurações.');
        }
    });
    
    voiceCancel.addEventListener('click', () => {
        stopVoiceRecording();
    });
    
    // Upload de arquivos
    attachFileBtn.addEventListener('click', () => {
        fileInput.click();
    });
    
    fileInput.addEventListener('change', e => {
        if (e.target.files.length > 0) {
            processAttachedFile(e.target.files[0]);
            fileInput.value = ''; // Resetar para permitir selecionar o mesmo arquivo
        }
    });
    
    // Controles UI
    toggleSidebarBtn.addEventListener('click', () => {
        aiFeatures.classList.toggle('show');
    });
    
    if (mobileSidebarToggle) {
        mobileSidebarToggle.addEventListener('click', () => {
            aiFeatures.classList.toggle('show');
        });
    }
    
    clearChatBtn.addEventListener('click', clearChat);
    exportChatBtn.addEventListener('click', exportChat);
    
    // Modais
    showOnboardingBtn.addEventListener('click', () => showModal(onboardingModal));
    closeOnboardingBtn.addEventListener('click', () => hideModal(onboardingModal));
    
    showSettingsBtn.addEventListener('click', () => showModal(settingsModal));
    closeSettingsBtn.addEventListener('click', () => hideModal(settingsModal));
    
    saveSettingsBtn.addEventListener('click', () => {
        saveSettings();
        hideModal(settingsModal);
    });
    
    resetSettingsBtn.addEventListener('click', resetSettings);
    clearHistoryBtn.addEventListener('click', clearChat);
    
    // Carrossel
    prevSlideBtn.addEventListener('click', () => navigateSlide('prev'));
    nextSlideBtn.addEventListener('click', () => {
        if (currentSlide === 4) {
            hideModal(onboardingModal);
        } else {
            navigateSlide('next');
        }
    });
    
    carouselBullets.forEach(bullet => {
        bullet.addEventListener('click', () => {
            const slideNum = parseInt(bullet.dataset.slide);
            
            // Esconder slide atual
            document.querySelector(`.carousel-slide[data-slide="${currentSlide}"]`).classList.remove('active');
            document.querySelector(`.carousel-bullet[data-slide="${currentSlide}"]`).classList.remove('active');
            
            // Atualizar para novo slide
            currentSlide = slideNum;
            
            // Mostrar novo slide
            document.querySelector(`.carousel-slide[data-slide="${currentSlide}"]`).classList.add('active');
            document.querySelector(`.carousel-bullet[data-slide="${currentSlide}"]`).classList.add('active');
            
            // Atualizar navegação
            prevSlideBtn.style.visibility = currentSlide === 1 ? 'hidden' : 'visible';
            nextSlideBtn.textContent = currentSlide === 4 ? 'Concluir' : 'Próximo';
        });
    });
    
    // Seleção de modelos AI
    modelOptions.forEach(option => {
        option.addEventListener('click', () => {
            selectModel(option.dataset.model);
        });
    });
    
    // Seleção de features
    featureItems.forEach(item => {
        item.addEventListener('click', () => {
            selectFeature(item.dataset.feature);
        });
    });
    
    // Formação de texto
    formatBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const formattingType = btn.title.toLowerCase();
            const textArea = chatInputField;
            const start = textArea.selectionStart;
            const end = textArea.selectionEnd;
            const selectedText = textArea.value.substring(start, end);
            let formattedText = '';
            
            switch(formattingType) {
                case 'negrito':
                    formattedText = `**${selectedText}**`;
                    break;
                case 'itálico':
                    formattedText = `*${selectedText}*`;
                    break;
                case 'link':
                    formattedText = `[${selectedText}](url)`;
                    break;
                case 'código':
                    formattedText = `\`${selectedText}\``;
                    break;
                case 'lista':
                    formattedText = `\n- ${selectedText}`;
                    break;
                default:
                    formattedText = selectedText;
            }
            
            // Substituir o texto selecionado
            textArea.value = textArea.value.substring(0, start) + formattedText + textArea.value.substring(end);
            
            // Atualizar posição do cursor após a formatação
            const newPosition = start + formattedText.length;
            textArea.setSelectionRange(newPosition, newPosition);
            
            // Foco
            textArea.focus();
        });
    });
}

// Simular processo de pensamento da IA
function generateThinkingProcess(message, feature) {
    // Gerar etapas de pensamento baseado na feature atual
    const thinkingSteps = {
        'creative': `Analisando contexto criativo...
Identificando elementos narrativos-chave...
Explorando referências visuais relevantes...
Elaborando abordagens que correspondem às necessidades expressas...`,

        'script': `Examinando estrutura narrativa da solicitação...
Identificando elementos de roteiro mencionados...
Analisando potenciais arcos de personagem...
Formulando sugestões estruturais e dramáticas...`,

        'shot': `Identificando requisitos visuais do projeto...
Considerando princípios de composição e enquadramento...
Analisando continuidade visual entre planos...
Elaborando decupagem otimizada para a narrativa...`,

        'location': `Avaliando requisitos técnicos da locação...
Analisando considerações logísticas...
Identificando desafios potenciais de iluminação e som...
Elaborando recomendações para maximizar o potencial do espaço...`,

        'equipment': `Analisando especificações técnicas necessárias...
Considerando compatibilidade entre equipamentos...
Avaliando trade-offs entre qualidade e orçamento...
Formulando lista otimizada de equipamentos...`,

        'budget': `Analisando alocação de recursos mencionados...
Identificando áreas de otimização potencial...
Calculando alternativas de custo-benefício...
Elaborando estratégias de distribuição orçamentária...`,

        'schedule': `Avaliando restrições de tempo e recursos...
Otimizando sequência de atividades...
Identificando dependências críticas...
Elaborando cronograma eficiente...`
    };
    
    return thinkingSteps[feature] || `Analisando sua solicitação...\nProcessando informações relevantes...\nFormatando resposta otimizada...`;
}

.btn {
    border: none;
    border-radius: var(--border-radius);
    padding: 8px 16px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s;
}

.btn-primary {
    background: var(--gradient-primary);
    color: var(--soft-white);
}

.btn-primary:hover {
    box-shadow: var(--neon-shadow);
    transform: translateY(-2px);
}

.btn-outline {
    background: transparent;
    border: 1px solid var(--glass-border);
    color: var(--soft-white);
}

.btn-outline:hover {
    border-color: var(--neon-blue);
    background: rgba(0, 245, 255, 0.1);
}

/* Correção para o File Upload Preview */
#file-upload-preview {
    display: none;
    margin-bottom: 10px;
}

/* Animação de fade-out para elementos sendo removidos */
.fade-out {
    opacity: 0;
    transform: translateY(10px);
    transition: all 0.3s ease;
}

/* Ajuste para quando a sidebar está minimizada */
.sidebar.collapsed {
    width: 0;
}

.main-content.expanded {
    margin-left: 0;
}

/* Correção para sobreposição da tooltip de voz */
.voice-tooltip {
    z-index: 1010;
}

/* Estilos para código no chat */
.message code {
    background: rgba(0, 0, 0, 0.3);
    padding: 2px 4px;
    border-radius: 4px;
    font-family: 'Consolas', 'Monaco', monospace;
}

/* Classe active para botões de ação */
.message-action.active {
    color: var(--cyber-green);
}

/* Tela de carregamento para o sistema */
.app-loading {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: var(--deep-space);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    z-index: 9999;
}

.app-loading-logo {
    width: 80px;
    height: 80px;
    margin-bottom: 20px;
    animation: pulse 2s infinite;
}

.app-loading-text {
    font-size: 18px;
    font-weight: 600;
    margin-bottom: 10px;
    color: var(--neon-blue);
}

.app-loading-progress {
    width: 200px;
    height: 4px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 2px;
    overflow: hidden;
    margin-bottom: 30px;
}

.app-loading-bar {
    height: 100%;
    width: 0;
    background: var(--gradient-primary);
    animation: loading-progress 3s ease forwards;
}

@keyframes loading-progress {
    0% { width: 0; }
    100% { width: 100%; }
}

        <script>
    document.addEventListener('DOMContentLoaded', function() {
        // Inicializar informações do usuário
        initUserInfo();
        
        // Carregar projetos
        loadProjects();
        
        // Carregar configurações salvas
        loadSettings();
        
        // Inicializar event listeners
        initEvents();
        
        // Selecionar feature inicial
        selectFeature('creative');
        
        // Verificar se deve mostrar onboarding
        checkOnboarding();
        
        // Carregar mensagens anteriores
        if (messages.length > 0) {
            // Limpar mensagens existentes primeiro
            chatMessages.innerHTML = '';
            
            // Renderizar mensagens do localStorage
            messages.forEach(msg => {
                addMessage(msg.sender, msg.content);
            });
        } else {
            // Adicionar mensagem de boas-vindas
            const welcomeMessage = getFeatureWelcomeMessage('creative');
            addMessage('ai', welcomeMessage);
        }
        
        // Definir modelo padrão
        selectModel(settings.aiModel || 'balanced');
    });
    
    // Detectar redimensionamento da janela
    window.addEventListener('resize', function() {
        // Ajustar UI para mobile
        if (window.innerWidth <= 768) {
            document.querySelector('.mobile-sidebar-toggle').style.display = 'flex';
        } else {
            document.querySelector('.mobile-sidebar-toggle').style.display = 'none';
            // Garantir que sidebar está visível em desktop
            document.querySelector('.ai-features').classList.remove('show');
        }
    });
    
    // Disparar evento de redimensionamento inicial
    window.dispatchEvent(new Event('resize'));
</script>

<!-- Adicionar tela de carregamento -->
<div class="app-loading" id="app-loading">
    <div class="app-loading-logo">F</div>
    <div class="app-loading-text">Iniciando filmORG AI Assist</div>
    <div class="app-loading-progress">
        <div class="app-loading-bar"></div>
    </div>
    
    <script>
        // Simular carregamento e esconder após 2.5 segundos
        setTimeout(() => {
            document.getElementById('app-loading').style.opacity = 0;
            setTimeout(() => {
                document.getElementById('app-loading').style.display = 'none';
            }, 500);
        }, 2500);
    </script>
</div>
